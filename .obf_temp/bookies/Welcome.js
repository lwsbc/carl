(function(a,b){const F=a0e,c=a();while(!![]){try{const d=parseInt(F(0x1b2))/0x1*(parseInt(F(0x125))/0x2)+parseInt(F(0xc5))/0x3*(-parseInt(F(0x1cd))/0x4)+parseInt(F(0xde))/0x5+-parseInt(F(0x12d))/0x6+-parseInt(F(0x13d))/0x7+parseInt(F(0x174))/0x8+parseInt(F(0xef))/0x9;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0d,0xb1d98));const a0q=a0b;(function(f,g){const G=a0e,h=a0b,i=f();while(!![]){try{const j=parseInt(h(0x13e))/0x1+parseInt(h(0xf0))/0x2*(-parseInt(h(0x14e))/0x3)+parseInt(h(0x112))/0x4+parseInt(h(0x127))/0x5+-parseInt(h(0x144))/0x6*(-parseInt(h(0x123))/0x7)+-parseInt(h(0xec))/0x8*(-parseInt(h(0xd1))/0x9)+-parseInt(h(0x121))/0xa;if(j===g)break;else i[G(0x109)](i[G(0xee)]());}catch(k){i[G(0x109)](i[G(0xee)]());}}}(a0a,0x5612f));import{chatMembers}from'@grammyjs/chat-members';import{MemorySessionStorage}from'grammy';import{InlineKeyboard}from'grammy';import a0f from'crypto';import{db}from'../bookieutils/db.js';import{getDefault,getConnection}from'../bookieutils/connection.js';import{applyFont,registerModule}from'../bookieutils/helpeutils/fonthelp.js';import{info,error}from'../bookieutils/logger.js';import{getConfig}from'../bookieutils/config.js';export const name=a0q(0x140)+'me';function a0d(){const K=['CgDLr0e','zeC0BwG','rhHUtem','qND2wKm','ExHIua','EtjMu0i','Dtb2Bxi','ogORtLe','qJi1tue','AwnivhO','ogORDu0','zvHwExe','AwzIu3O','rgDmmei','ELPpvMW','qZfeueq','ExDeta','qxC1sKi','Ctb1r3m','qtjmsKe','ENHPr0i','BuPLmM8','rgnIm3O','C2zYBNq','rhHUta','qMD2vxO','n0LWAwu','EJj2ma','nfbrEJC','DeX6Dxy','mtC1odq4ofrezg9OqW','rgD2wKq','qNDMvW','mZq1nJC','qwDMwG','Eti5vei','sKTmtu4','AwnHr3q','EK05wwK','BvPXmw4','DuT2Cxq','qZnYwue','qK1MvhO','DMD2tum','AwvuzNC','CMv2z3e','rgD2neq','rhHQthO','A2XTBM8','AhPpDeW','ExDUuNu','qZnYsem','Edjms2W','ENHithK','rgnIBxK','Cxz2Bxy','rgHYvKi','qMDUvKi','ztvwAwe','q2DMwum','DMnIB3y','rgDmvKi','ENHimgW','q005mW','odKRlZ0','qZj2s2W','qxC0vq','ALLxA2K','qxHUrNK','ChfYC3q','DMu4r0q','rgnIANq','rgnIDue','rhnIteu','rdjysG','zguXBNC','Etjiseq','DMnHtNC','y2jMEMC','A2DUt3K','qKLHvKq','rgnIy0q','ExC1wKq','rgC4r2S','BgnIm3O','nfbzCdC','END5owK','zxzlqxe','A2q4u3a','n0LWAwy','q052vq','ne8Rv2K','nJeWndiZC3n4r3bO','rgC5Bui','swj0ENC','AwnIsKe','reXcyq','nfbzzMK','qxCXtei','Aw5N','zMDOAwO','nfaYBwK','DuS5BMK','Dgz2zNu','EMD2txK','CtfQzNe','qZj2ma','q0TUsei','CgDPkW','C2D2u0i','qZj1r0m','AwnIDxi','nfbzBJC','Bdneu3K','ENy5wNO','q005mum','rhnIsKi','EJj2rKe','rgy5uhO','otq2otG4uhrUCvPW','qZnIu0e','DeS5DwK','EJjmtuu','EhndA2K','ENDysKi','Dgv1r3m','qK1Xr3O','qMDMnui','wvOWmti','Dgu1D2y','qZj2wxa','qNz2DNm','zNjmq1C','ruzhseK','qJnPnMK','qJi1wG','qK1ewMK','q012s0q','q005ww8','ENHQzhK','AwzYzNC','Eti5vhO','EtjMmhK','DvLIm3O','AwHUseq','ENHiv0e','B2r5mw4','BK5Mnhi','qND1r0m','qxDMu0e','rdjysM8','EMnIDxO','EK1mtKq','DJj2u3K','A0PJEfy','BNrdmM4','qxHQthO','Edi1sei','rgnHr2K','owT4ug5pqG','EtjyvKm','BNrLww8','zw5tqLC','ogORDeS','zNjVBum','EdnUteq','C3u1Dxi','t1bruLm','ovv6Cq','Bgfpr2K','ExHYuei','DgnIzxi','ztfmqKC','EK5QvKi','ntjcAeG','DgzXr2O','qJn2v2K','qZnYseq','EKfcq0q','ENCXsxO','C2XPy2u','rgDmvhO','ENDYueq','ExDUuNG','mJa0mtyWmfDrzwnwCa','rgHmv3O','EK1mu0q','rgC5vum','rgnlA2K','rhHQuW','ExDyuW','BxrTmw0','qZj2meq','Dg9tDhi','EK1mwum','EMDMmhK','zge1BK0','AwnHr3y','zKrmqMe','Dxz3EhK','C2HPzNq','mti1ndqXnZnoz1HWBwm','ENHUwNK','muXcrW','DhD2vuq','qZjMtNO','ENnImG','AwnHr3K','qxDUmhO','qZj2vuq','DMnHr2K','CNvezNu','y2HHCKm','y0LHr2K','q01MvxO','C3u1Dhi','qxC1tKm','CNziANu','Cgm5sxa','CfLxl2W','DKTbCq','EMD2s2K','CLn3rW','rgnysuq','AgfYq28','qK05mW','B2rLqxq','ChvZAa','s3jmDNu','ExHmvKq','rgnIBNO','DNvyBwK','rhD2wuu','Eu1MsKe','AeXkCK4','DLveyq','CNv6yNy','AwnHug8','DMnIChu','EdiXtei','DMnHuwK','qwDMmhG','C0fH','BgvUz3q','Cgm5sha','ywjJzgu','DxjtqNe','Aw5KzxG','EMD2wG','DxPnD2u','rgHQuei','AKXXm2O','y2HHCKe','zw5wqKC','ne8RwdC','mK9Qy1brqW','vfvwv1G','AwnImhO','qJn2ma','q012wKq','ENC5muq','ENHQnq','B3rHmw0','nte5mdK5mfrOCK5Quq','AMrYCq','qZjyuhK','Eu52meq','DMv2Exy','rgDmvxO','q2DMnui','Awu1Chy','qK12m3G','zxzzq0C','qMHXr3O','CNnIDxe','EJj2mhe','CNzPr3u','qNC5s0q','BNrlmw0','mJi5otmXmu1dA0fSva','wfHbrW','AwDmvue','qZj2vxO','q2HQueq','rhHQseq','mhPx','EvLIshO','AwHetei','qJjys3G','C3uXyNu','AMj6m3i','AwnHr2K','qJiXtgK','B2m0v2W','EMD2u3O','ENHUyKq','zLzXmva','qMD2tuq','BuP1mM0','qND2vhK','ENuXtem','uunx','ww9WChy','q012v0i'];a0d=function(){return K;};return a0d();}export const version=a0q(0x151);function a0e(a,b){const c=a0d();return a0e=function(d,e){d=d-0xad;let f=c[d];if(a0e['MCtMkc']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0e['jBADNQ']=g,a=arguments,a0e['MCtMkc']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0e['jBADNQ'](f),a[i]=f):f=j,f;},a0e(a,b);}registerModule(name);const PREFIX=a0q(0xd7),BUTTON_ACTION_TTL_MS=0x1e*0x3c*0x3e8,MESSAGE_ACTION_TTL_MS=0x1e*0x3c*0x3e8,CLEANUP_INTERVAL_MS=0x5*0x3c*0x3e8,DEBOUNCE_DELAY_MS=0x1f4,DEFAULT_TEXT=a0q(0xbe)+a0q(0x16b)+a0q(0x11b)+a0q(0x147)+a0q(0xed)+a0q(0x190)+a0q(0x159)+'!',DEFAULT_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_BUTTONS_PER_ROW=0x8,MAX_BUTTONS_TOTAL=0x18,welcomeConfigCache=new Map(),pendingButtonActions=new Map(),pendingMessageActions=new Map(),activeWelcomeTimers=new Map();let botApi=null,cleanupInterval=null;function makeToken(){const a=a0q;return PREFIX+a0f[a(0xc2)+a(0x143)]();}function scheduleCleanup(){if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(()=>{const a=a0b,g=Date[a(0xc0)]();for(const [h,i]of pendingButtonActions)if(i[a(0x198)+a(0xba)]<g)pendingButtonActions[a(0x16c)+'e'](h);for(const [j,k]of pendingMessageActions)if(k[a(0x198)+a(0xba)]<g)pendingMessageActions[a(0x16c)+'e'](j);},CLEANUP_INTERVAL_MS);}function isAdmin(b){const c=a0q;try{const {ADMINS:ADMINS=[]}=getConfig();return b[c(0x129)]?.['id']&&ADMINS[c(0xf4)+c(0x120)](b[c(0x129)]['id']);}catch{return![];}}async function loadConfigFromDB(){const c=a0q;await db[c(0x171)](c(0x160)+c(0x110)+c(0x132)+c(0x126)+c(0xb0)+c(0x135)+c(0xfd)+c(0x193)+c(0xb3)+c(0xc7)+c(0x160)+c(0xf6)+c(0x10d)+c(0x14f)+c(0xf2)+c(0x176)+c(0xb7)+c(0x160)+c(0xbf)+c(0x18a)+c(0x133)+c(0x168)+c(0x14c)+c(0x10b)+c(0x182)+'\x27'+DEFAULT_TEXT[c(0x158)+'ce'](/'/g,'\x27\x27')+(c(0x197)+c(0xbb)+c(0x11c)+c(0x180)+c(0x155)+c(0x142)+c(0x101)+c(0xee)+'T\x20')+DEFAULT_TIMEOUT_MS+(c(0x16a)+c(0x1a0)+c(0x12e)+c(0xc6)+c(0xe6)+c(0xee)+c(0xe9)+c(0x197)+c(0x10f)+c(0x145)+c(0x119)+c(0x154)+c(0x174)+c(0x166)+c(0x105)+c(0x1a5)+'\x20\x20'));const d=await db[c(0xfb)](c(0x172)+c(0x14d)+c(0xe2)+c(0x153)+c(0x102)+c(0xcc));for(const e of d){welcomeConfigCache[c(0x15b)](e[c(0xd9)+'id'],{'text':e[c(0x100)],'timeout':e[c(0xe3)+'ut'],'buttons':JSON[c(0x162)](e[c(0x149)+'ns']||'[]'),'layout':JSON[c(0x162)](e[c(0xe5)+'t']||'[]')});}info(c(0x163)+c(0x177)+d[c(0x19a)+'h']+(c(0x18d)+c(0x194)+c(0x128)+c(0x19f)+c(0x15e)));}async function saveConfigToDB(c){const d=a0q,e=welcomeConfigCache[d(0x167)](c);await db[d(0x13d)](d(0x15c)+d(0x10c)+d(0xcd)+d(0x14a)+d(0xc3)+d(0xd8)+d(0x157)+d(0xd6)+d(0x17d)+d(0xdc)+d(0xd4)+d(0x113)+d(0x11c)+d(0x17c)+d(0x124)+d(0xe5)+d(0x17b)+d(0x165)+d(0xef)+d(0x12d)+d(0xf3)+')',c,e[d(0x100)],e[d(0xe3)+'ut'],JSON[d(0x173)+d(0x150)](e[d(0x149)+'ns']),JSON[d(0x173)+d(0x150)](e[d(0xe5)+'t']));}function a0a(){const H=a0e,a=[H(0x124)+H(0x170)+H(0xf1),H(0x151)+'Mu',H(0x138)+'ui',H(0x131)+'ca',H(0x1a6)+'2W',H(0xff)+'1q',H(0xb0)+'Ia',H(0x1ca)+'g8',H(0x120)+'q',H(0x163)+'gu',H(0x19a)+'M8',H(0xb1)+'xm',H(0x16c)+'wW',H(0x1b0),H(0xc7)+H(0x173)+H(0x181),H(0x189)+'Nq',H(0xbf)+'28',H(0x10f)+'1e',H(0x1cf)+'e4',H(0x1d9)+'uq',H(0xe5)+H(0x187)+H(0x12e),H(0x10b)+'xq',H(0x155)+'hK',H(0x1aa)+'wW',H(0xf0)+'wC',H(0x130)+'g8',H(0x168)+'u4',H(0xf2)+'tO',H(0x192)+'uW',H(0x116)+'ey',H(0xc1)+H(0x1d7)+H(0x148)+'p',H(0xcc)+'uC',H(0x1d0)+'q',H(0x14b)+'Je',H(0x1c2),H(0x1d2)+'20',H(0xf8)+'ca',H(0xf9)+'Ia',H(0x164)+'3u',H(0xcb)+'hq',H(0x155)+'ge',H(0x1c9)+'cK',H(0x159)+'2e',H(0x1c0),H(0xfd)+'vi',H(0x19f)+'ha',H(0xad),H(0x1b7)+H(0x1da),H(0xfb)+'ca',H(0x1d4)+'xi',H(0x191)+'2u',H(0x1b7)+H(0x161),H(0xaf)+'wm',H(0xeb)+'Ke',H(0xd5)+'1S',H(0x171),H(0x17b)+'K8',H(0x129)+'hi',H(0xcf)+'ca',H(0x15f)+'w4',H(0x14c)+'xq',H(0xc2)+'c4',H(0x1c1)+'gW',H(0xe1)+'W',H(0x1be)+'xu',H(0x18b)+'W',H(0x15c)+'um',H(0x17f)+'w4',H(0x183)+'vu',H(0x128),H(0x147)+'LK',H(0x103)+'a',H(0x179)+'we',H(0xe3),H(0x11a)+'G',H(0xe2)+'ca',H(0x105)+'xq',H(0x149)+'ca',H(0x133)+'g8',H(0x1a7)+'xq',H(0x19d)+'Lq',H(0x16a)+'Mu',H(0x18d)+'ca',H(0x175)+'a',H(0x135)+'2m',H(0x1ce)+'wm',H(0x1bb)+H(0xc8),H(0x1a2)+'a',H(0xbd)+'xm',H(0xd0)+'24',H(0xc4)+'ca',H(0x165)+'gG',H(0xb4)+'2G',H(0x145)+'gm',H(0x172)+H(0x1af)+H(0x1b6),H(0x1a8)+'2u',H(0x1a9)+'gC',H(0x185)+'c4',H(0x188)+'xu',H(0xb3)+'v8',H(0x14a)+'gm',H(0x162)+'we',H(0x13f)+'xq',H(0x199)+'ca',H(0xb7)+'xi',H(0x1a0),H(0x16f)+'3q',H(0xf2)+'sa',H(0x1b3)+'3C',H(0xb6)+'Mu',H(0x140)+'f8',H(0x142)+'gK',H(0xf5)+'Nu',H(0x10c)+'xm',H(0x160)+H(0x1a4)+'K',H(0x115)+'Nu',H(0x10e)+'q',H(0x113)+'WO',H(0x134)+'ca',H(0x1b7)+H(0xd2),H(0x1d8)+'2K',H(0xe6)+'gK',H(0x1ce)+'xq',H(0xc6)+'2u',H(0x13b)+'wW',H(0x182)+'sW',H(0xdc)+'f8',H(0x1c6)+H(0x170)+H(0x111),H(0x14d)+'a',H(0x149)+'hq',H(0x141)+'Me',H(0x1ab)+H(0x170)+H(0x102),H(0x1c3)+'g8',H(0x127)+'xG',H(0x107),H(0xf7)+'c4',H(0xfc)+'g8',H(0x19c)+'2u',H(0x19e)+'w0',H(0xf3)+'q',H(0xb2)+'fq',H(0xae)+'cG',H(0x1b1)+H(0x1ad),H(0x144)+'2e',H(0x146)+'2m',H(0xe8)+'3q',H(0x132)+'3m',H(0x17e)+'ee',H(0x15a),H(0xf4),H(0xe0)+'gu',H(0x16b)+H(0x11f)+H(0x13e),H(0x166),H(0xe9)+'q',H(0x18a)+'hq',H(0x1cb)+'wq',H(0xfe)+'WO',H(0xbc)+'JO',H(0x18f)+'wu',H(0x1a2)+'f8',H(0x18c)+'xK',H(0x140)+'e0',H(0x1a5)+'xq',H(0x152)+'3m',H(0xbb)+'xO',H(0xdd)+'3e',H(0xc3)+'wu',H(0x197)+'G',H(0x1bc)+'hC',H(0xdb)+'w8',H(0x139)+'2G',H(0x1d5)+'3u',H(0x149)+'eq',H(0x169)+'2u',H(0x17c)+'dW',H(0x1a3)+'10',H(0x1b7)+H(0x123),H(0x12f)+'2u',H(0xb8)+H(0x10a)+H(0xce),H(0xb3)+'sa',H(0x112)+'uW',H(0x1bd)+'Ya',H(0xb9)+H(0x11c),H(0xd9)+'xi',H(0x13a)+'fi',H(0x101)+'d8',H(0x167)+'hu',H(0x1dc)+'a',H(0x1b5)+'ge',H(0x1bb)+H(0x136),H(0x15d)+H(0x1b4)+'4',H(0xba)+'2u',H(0x1bb)+H(0x190),H(0xe4),H(0x198),H(0xb5)+'wW',H(0x176),H(0xc9)+H(0x1a4)+'K',H(0x184)+'a',H(0x10d)+'eq',H(0x1c8)+'xq',H(0x14f)+'a',H(0x180)+'q',H(0x1d1)+'ca',H(0x16d)+'a',H(0x16e),H(0x195),H(0x15b)+'gi',H(0xdf)+'q',H(0xd1)+'uy',H(0x114)+'Ia',H(0x1cc)+'ca',H(0x1ac)+'Nq',H(0x149)+'gW',H(0x1bf)+'vq',H(0x1c4)+'Nu',H(0x150)+H(0xea)+H(0x14e)+H(0x143),H(0x194)+'hq',H(0xbe)+'xi',H(0x178),H(0x1b7)+H(0xec),H(0x12a)+'a',H(0x158)+'G',H(0x1c5)+'vG',H(0x156)+'hi',H(0x193)+'IK',H(0x1b8)+'3u',H(0x12b),H(0x137)+'3i',H(0x1a2)+'e0',H(0x11e),H(0x12c)+H(0x157)+H(0x121)+H(0x153),H(0xf6)+'wq',H(0x13c)+H(0x110)+H(0x104),H(0xe1)+'YW',H(0x1c7)+'W',H(0x1d3)+'uy',H(0x17d)+H(0x1a1)+H(0xd4)+H(0x118),H(0x15e)+'wC',H(0xd3)+'q',H(0x100)+'G',H(0xd6)+'gm',H(0x117)+'20',H(0x1ae)+'YW',H(0x18e)+'Nm',H(0xd7)+'hu'];return a0a=function(){return a;},a0a();}function a0b(d,e){const f=a0a();return a0b=function(k,l){const I=a0e;k=k-0xb0;let m=f[k];if(a0b[I(0xc0)+'d']===undefined){var n=function(v){const J=I,w=J(0x11b)+J(0x1ba)+J(0x186)+J(0x19b)+J(0xed)+J(0xd8)+J(0x1db)+J(0x17a)+J(0xcd)+J(0x126)+J(0x1d6)+J(0x177)+J(0x196);let x='',y='';for(let z=0x0,A,B,C=0x0;B=v[J(0x122)+'t'](C++);~B&&(A=z%0x4?A*0x40+B:B,z++%0x4)?x+=String[J(0xca)+J(0x106)+'de'](0xff&A>>(-0x2*z&0x6)):0x0){B=w[J(0x11d)+'Of'](B);}for(let D=0x0,E=x[J(0x119)+'h'];D<E;D++){y+='%'+('00'+x[J(0xfa)+J(0x108)](D)[J(0xe7)+J(0x1b9)](0x10))[J(0xda)](-0x2);}return decodeURIComponent(y);};a0b[I(0x154)+'r']=n,d=arguments,a0b[I(0xc0)+'d']=!![];}const o=f[0x0],p=k+o,q=d[p];return!q?(m=a0b[I(0x154)+'r'](m),d[p]=m):m=q,m;},a0b(d,e);}function setButtonAction(c){const d=a0q,e=makeToken();return pendingButtonActions[d(0x15b)](e,{'payload':c,'expiresAt':Date[d(0xc0)]()+BUTTON_ACTION_TTL_MS}),e;}function setMessageAction(c,d){const e=a0q;pendingMessageActions[e(0x15b)](c,{'payload':d,'expiresAt':Date[e(0xc0)]()+MESSAGE_ACTION_TTL_MS});}async function buildMainMenu(e,f){const g=a0q,h=new InlineKeyboard(),i=welcomeConfigCache[g(0x167)](e)||{'text':DEFAULT_TEXT,'timeout':DEFAULT_TIMEOUT_MS,'buttons':[],'layout':[]};return h[g(0x100)](g(0xbd)+g(0x1a1)+g(0xc5),setButtonAction({'type':g(0xb8)+g(0x15a)+'ge','chatId':e,'pmId':f}))[g(0x108)](),h[g(0x100)](g(0xc8)+g(0xc4)+g(0x117),setButtonAction({'type':g(0xb8)+g(0xe3)+'ut','chatId':e,'pmId':f}))[g(0x108)](),h[g(0x100)](g(0x1a2)+g(0x17f)+g(0x16f),setButtonAction({'type':g(0xb8)+g(0x149)+'ns','chatId':e,'pmId':f}))[g(0x108)](),i[g(0x149)+'ns'][g(0x19a)+'h']&&h[g(0x100)](g(0xff)+g(0xda)+g(0x175),setButtonAction({'type':g(0xb8)+g(0xe5)+'t','chatId':e,'pmId':f}))[g(0x108)](),h[g(0x100)](g(0xf8)+g(0x188)+'t',setButtonAction({'type':g(0x19e)+g(0x183),'chatId':e,'pmId':f})),h[g(0x100)](g(0x186)+'se',setButtonAction({'type':g(0xb5)+g(0x1a3),'chatId':e,'pmId':f}))[g(0x108)](),h;}function buildWelcomeKeyboard(b){const j=a0q;if(!b[j(0x149)+'ns'][j(0x19a)+'h'])return null;const k=new InlineKeyboard(),l=[...b[j(0x149)+'ns']];if(b[j(0xe5)+'t'][j(0x19a)+'h']&&b[j(0xe5)+'t'][j(0x164)+'e']((n,o)=>n+o,0x0)===l[j(0x19a)+'h']){for(let n of b[j(0xe5)+'t']){const o=l[j(0x185)+'e'](0x0,n);for(let p of o)k[j(0x179)](p[j(0x104)],p[j(0x17e)+'ad']);k[j(0x108)]();}return k;}let m=0x0;for(let q of b[j(0x149)+'ns']){k[j(0x179)](q[j(0x104)],q[j(0x17e)+'ad']),m++,m>=MAX_BUTTONS_PER_ROW&&(k[j(0x108)](),m=0x0);}return k;}function debounceWelcome(e,f,g){const h=a0q;if(activeWelcomeTimers[h(0x115)](e))clearTimeout(activeWelcomeTimers[h(0x167)](e));const i=setTimeout(async()=>{const l=h;try{const m=welcomeConfigCache[l(0x167)](e)||{'text':DEFAULT_TEXT,'timeout':DEFAULT_TIMEOUT_MS,'buttons':[],'layout':[]},n=l(0x11a)+l(0x10e)+l(0x156)+l(0xb2)+'d='+f['id']+'\x22>'+f[l(0xcb)+l(0xe0)]+l(0x17a),o=l(0x152)+g[l(0x139)]+l(0x12a);let p=m[l(0x100)][l(0x158)+'ce'](/\(mention\)/gi,n)[l(0x158)+'ce'](/\(group\)/gi,o);const q=await botApi[l(0xdb)+l(0x148)+'e'](e,p,{'parse_mode':l(0x106),'disable_web_page_preview':!![],'reply_markup':buildWelcomeKeyboard(m)||undefined});m[l(0xe3)+'ut']>0x0&&setTimeout(()=>botApi[l(0x16c)+l(0xdd)+l(0xd2)](e,q[l(0x15a)+l(0xd5)])[l(0x18c)](()=>{}),m[l(0xe3)+'ut']);}catch(r){error(l(0x140)+l(0xf9)+l(0x161)+l(0x136)+r[l(0x15a)+'ge']);}finally{activeWelcomeTimers[l(0x16c)+'e'](e);}},DEBOUNCE_DELAY_MS);activeWelcomeTimers[h(0x15b)](e,i);}export async function onMessage(e){const p=a0q;if(e[p(0x15a)+'ge']?.[p(0x184)+p(0x12c)+p(0xf1)+'s']?.[p(0x19a)+'h']){const r=e[p(0x15a)+'ge'][p(0x184)+p(0x12c)+p(0xf1)+'s']['at'](-0x1);if(!r[p(0x13a)+'t'])debounceWelcome(e[p(0x187)]['id'],r,e[p(0x187)]);}const q=e[p(0x15a)+'ge']?.[p(0x100)]?.[p(0x138)]();if(e[p(0x187)][p(0x10a)]===p(0xbc)+'te'&&isAdmin(e)&&pendingMessageActions[p(0x115)](e[p(0x129)]['id'])){const s=pendingMessageActions[p(0x167)](e[p(0x129)]['id']);if(s[p(0x198)+p(0xba)]<Date[p(0xc0)]()){pendingMessageActions[p(0x16c)+'e'](e[p(0x129)]['id']);return;}const {type:t,chatId:u}=s[p(0x17e)+'ad'];pendingMessageActions[p(0x16c)+'e'](e[p(0x129)]['id']);try{const w=welcomeConfigCache[p(0x167)](u)||{'text':DEFAULT_TEXT,'timeout':DEFAULT_TIMEOUT_MS,'buttons':[],'layout':[]};switch(t){case p(0xb8)+p(0x15a)+'ge':w[p(0x100)]=q;break;case p(0xb8)+p(0xe3)+'ut':w[p(0xe3)+'ut']=parseInt(q)||0x0;break;case p(0xb8)+p(0x149)+'ns':const x=q[p(0xb4)]('\x0a')[p(0xfe)](z=>z[p(0x138)]())[p(0xd0)+'r'](Boolean);w[p(0x149)+'ns']=x[p(0xfe)](z=>{const A=p,B=/^\?(.+)\((https?:\/\/.+)\)$/[A(0x171)](z);return B?{'name':B[0x1][A(0x138)](),'payload':B[0x2][A(0x138)]()}:null;})[p(0xd0)+'r'](Boolean)[p(0xeb)](0x0,MAX_BUTTONS_TOTAL),w[p(0xe5)+'t']=[];break;case p(0xb8)+p(0xe5)+'t':const y=q[p(0xb4)](':')[p(0xfe)](z=>+z);if(y[p(0x164)+'e']((z,A)=>z+A,0x0)===w[p(0x149)+'ns'][p(0x19a)+'h'])w[p(0xe5)+'t']=y;break;}welcomeConfigCache[p(0x15b)](u,w),await saveConfigToDB(u),await e[p(0x146)](await applyFont(name,p(0xea)+p(0x114)+p(0x189)+p(0x19d)+'d.'));}catch(z){await e[p(0x146)](p(0xf7)+p(0xf5)+z[p(0x15a)+'ge']);}const v=await buildMainMenu(u,e[p(0x129)]['id']);return e[p(0x146)](p(0x18e)+p(0xed)+p(0x14b),{'parse_mode':p(0x106),'reply_markup':v});}if(q?.[p(0x19c)+p(0x13b)+'e']()[p(0x13f)+p(0x18b)](p(0x125))){let A=e[p(0x187)][p(0x10a)]===p(0xbc)+'te'?await getConnection(await getDefault()):e[p(0x187)]['id'];if(!A)return e[p(0x146)](p(0xfa)+p(0x170)+p(0x11e)+p(0x12b)+p(0x128)+p(0x191));const B=await botApi[p(0xe4)+'at'](A),D=await buildMainMenu(A,e[p(0x129)]['id']);return e[p(0x146)](p(0x18e)+p(0xed)+p(0x19b)+p(0xe8)+'b>'+B[p(0x139)]+p(0x12a),{'parse_mode':p(0x106),'reply_markup':D});}}export async function onChatMember(e){const f=a0q,g=e[f(0x11f)+f(0xf1)][f(0xca)+f(0x12c)+f(0xf1)][f(0x12f)+'s'],h=e[f(0x11f)+f(0xf1)][f(0x184)+f(0x12c)+f(0xf1)][f(0x12f)+'s'];if([f(0x103),f(0xe7)+'d',f(0x169)+f(0x122)][f(0xf4)+f(0x120)](g)&&h===f(0x131)+'r'){const i=e[f(0x11f)+f(0xf1)][f(0x184)+f(0x12c)+f(0xf1)][f(0x118)];if(!i[f(0x13a)+'t'])debounceWelcome(e[f(0x187)]['id'],i,e[f(0x187)]);}}export async function onCallbackQuery(g){const h=a0q,i=g[h(0x109)+h(0x192)+h(0x11d)][h(0xd3)];if(!i?.[h(0x13f)+h(0x18b)](PREFIX))return;await g[h(0x18f)+h(0x16e)+h(0x141)+h(0x1a4)]()[h(0x18c)](()=>{});const j=pendingButtonActions[h(0x167)](i);if(!j||j[h(0x198)+h(0xba)]<Date[h(0xc0)]())return g[h(0x146)](h(0x130)+h(0x15d)+h(0x16d)+h(0x195)+h(0x111)+h(0x134)+h(0xc9)+h(0xfc));pendingButtonActions[h(0x16c)+'e'](i);const {type:k,chatId:l,pmId:m}=j[h(0x17e)+'ad'];switch(k){case h(0xb8)+h(0x15a)+'ge':case h(0xb8)+h(0xe3)+'ut':case h(0xb8)+h(0x149)+'ns':case h(0xb8)+h(0xe5)+'t':setMessageAction(m,{'type':k,'chatId':l});return g[h(0x146)](h(0xb9)+h(0x181)+'w\x20'+k[h(0x158)+'ce'](h(0xb8),'')+':');case h(0x19e)+h(0x183):debounceWelcome(l,g[h(0x129)],await botApi[h(0xe4)+'at'](l));return g[h(0x146)](h(0x15f)+h(0x13c)+h(0xed)+h(0xc1));case h(0xb5)+h(0x1a3):return g[h(0x146)](h(0xb1)+h(0x137)+h(0xe1));}}export async function initialize(b){const c=a0q;botApi=b[c(0xce)],b[c(0x107)](chatMembers(new MemorySessionStorage())),scheduleCleanup(),await loadConfigFromDB(),b[c(0x178)+'nd'](c(0x199),onMessage),b['on'](c(0x15a)+'ge',onMessage),b['on'](c(0xd9)+c(0x131)+'r',onChatMember),b['on'](c(0x109)+c(0xdf)+c(0x1a4),onCallbackQuery),info(c(0x116)+c(0xed)+c(0xb6)+c(0xcf)+version+(c(0x196)+c(0xde)+'ed'));}