(function(a,b){const F=a0e,c=a();while(!![]){try{const d=parseInt(F(0x10a))/0x1+parseInt(F(0x14d))/0x2*(-parseInt(F(0x158))/0x3)+-parseInt(F(0xd9))/0x4+parseInt(F(0x1b3))/0x5+parseInt(F(0x1b7))/0x6+parseInt(F(0xdf))/0x7+-parseInt(F(0xfa))/0x8;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0d,0x6a99e));const a0m=a0b;(function(f,g){const G=a0e,h=a0b,i=f();while(!![]){try{const j=parseInt(h(0x1e3))/0x1+-parseInt(h(0x1f9))/0x2+-parseInt(h(0x20d))/0x3+-parseInt(h(0x25a))/0x4+parseInt(h(0x21e))/0x5+-parseInt(h(0x24a))/0x6*(parseInt(h(0x250))/0x7)+parseInt(h(0x1d0))/0x8*(parseInt(h(0x23c))/0x9);if(j===g)break;else i[G(0x160)](i[G(0xc6)]());}catch(k){i[G(0x160)](i[G(0xc6)]());}}}(a0a,0x98dcf));import{Bot,webhookCallback,InputFile}from'grammy';import a0f from'fastify';import{readFileSync,existsSync,rmSync,mkdirSync}from'fs';import{execSync}from'child_process';import{networkInterfaces}from'os';import{dirname,join,resolve}from'path';import{fileURLToPath}from'url';import{info,warn,error,debug}from'./bookieutils/logger.js';import{getConfig,hotReloadConfig}from'./bookieutils/config.js';function a0b(d,e){const f=a0a();return a0b=function(k,l){const H=a0e;k=k-0x1c8;let m=f[k];if(a0b[H(0xe0)+'z']===undefined){var n=function(v){const I=H,w=I(0xfc)+I(0x120)+I(0x171)+I(0x15d)+I(0x112)+I(0xdc)+I(0x14c)+I(0xd2)+I(0x151)+I(0x174)+I(0x18f)+I(0x1a4)+I(0xea);let x='',y='';for(let z=0x0,A,B,C=0x0;B=v[I(0xd7)+'t'](C++);~B&&(A=z%0x4?A*0x40+B:B,z++%0x4)?x+=String[I(0x144)+I(0x150)+'de'](0xff&A>>(-0x2*z&0x6)):0x0){B=w[I(0x15e)+'Of'](B);}for(let D=0x0,E=x[I(0x103)+'h'];D<E;D++){y+='%'+('00'+x[I(0x18e)+I(0x13b)](D)[I(0x1a1)+I(0xbf)](0x10))[I(0x125)](-0x2);}return decodeURIComponent(y);};a0b[H(0x152)+'k']=n,d=arguments,a0b[H(0xe0)+'z']=!![];}const o=f[0x0],p=k+o,q=d[p];return!q?(m=a0b[H(0x152)+'k'](m),d[p]=m):m=q,m;},a0b(d,e);}import{initializeModules}from'./bookieutils/loader.js';import{initializeDatabase}from'./bookieutils/db.js';import{autoRetry}from'@grammyjs/auto-retry';import{limit}from'@grammyjs/ratelimiter';const __dirname=dirname(fileURLToPath(import.meta[a0m(0x272)])),ROOT=resolve(__dirname),RES_DIR=join(ROOT,a0m(0x228)),CERT_DIR=join(RES_DIR,a0m(0x274),a0m(0x270)),CERT_PATH=join(CERT_DIR,a0m(0x1d6)+a0m(0x1e1)+a0m(0x208)+'rt'),KEY_PATH=join(CERT_DIR,a0m(0x1d6)+a0m(0x1e1)+a0m(0x1db)+'ey');let bot,fastify;function a0e(a,b){const c=a0d();return a0e=function(d,e){d=d-0xbe;let f=c[d];if(a0e['erKkyl']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0e['IMtVUS']=g,a=arguments,a0e['erKkyl']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0e['IMtVUS'](f),a[i]=f):f=j,f;},a0e(a,b);}process['on'](a0m(0x1fa)+a0m(0x22a)+a0m(0x1e2)+a0m(0x24f),b=>{const c=a0m;error(c(0x206)+c(0x263)+c(0x1eb)+c(0x231)+c(0x21f)+c(0x26d),b);}),process['on'](a0m(0x21d)+a0m(0x216)+a0m(0x218)+'on',b=>{const c=a0m;error(c(0x1e6)+c(0x1d7)+c(0x234)+c(0x246)+':',b);});function a0a(){const J=a0e,a=[J(0xde)+J(0x187)+'q',J(0x146)+'em',J(0xe1)+J(0x13e)+J(0x145)+J(0xc2),J(0x188)+'1i',J(0x121)+'dK',J(0x16d)+'G',J(0xcc)+'a',J(0x18d)+'2S',J(0x194)+'ca',J(0xf0)+'Me',J(0x19a)+'xG',J(0xc3)+'xG',J(0x15c)+'q',J(0xe2)+'gK',J(0x137)+'sa',J(0x172)+'Ia',J(0x122),J(0xce)+'q',J(0x12a)+'xu',J(0x1a8)+J(0xf3)+J(0x14e)+J(0x1ac),J(0x12d)+'wm',J(0x167)+'gq',J(0x13f)+'v8',J(0x13c)+'3q',J(0x192)+'G',J(0x13d)+J(0x118)+'q',J(0x117)+'xq',J(0x10f)+'gK',J(0xca)+'dO',J(0xd3),J(0x11a)+'w8',J(0xe3)+'fi',J(0x1b5)+'Ya',J(0x101)+'a',J(0x1ad)+'Nq',J(0x155),J(0x11b),J(0x16e)+'xm',J(0xfb)+'sa',J(0x11e)+'Mu',J(0x1b6)+'24',J(0xdb)+'2u',J(0x133)+'xm',J(0x19d)+'hm',J(0xd0)+'g8',J(0x10e)+'gK',J(0x140)+'xq',J(0x197)+'a',J(0x168)+'xq',J(0xe8)+J(0x139),J(0xd1)+'w0',J(0x11d)+'gG',J(0x1a9)+'2u',J(0x191)+'Ya',J(0x1a7)+'04',J(0xf4),J(0x17b)+'Ni',J(0xc1)+'w4',J(0x164)+'xi',J(0x111)+'24',J(0x1ab)+'xm',J(0x142)+'2u',J(0x154)+'Ye',J(0x18b)+J(0x107)+J(0x185)+J(0x10b),J(0xeb)+'gu',J(0x147)+J(0x124)+'4',J(0x161)+'vq',J(0x17a)+'2S',J(0xc5),J(0xdd)+J(0x134),J(0x148)+'Me',J(0x178)+'w4',J(0x19e)+'gK',J(0x14a)+J(0x123),J(0xd6)+'gW',J(0x138)+'xy',J(0x198)+'04',J(0x177)+J(0xc7)+'4',J(0x153)+'ca',J(0x1a6)+J(0xed)+J(0xef)+'L',J(0x193)+'c0',J(0x113)+J(0x159)+'i',J(0x157)+'q',J(0x196)+'3K',J(0x17d)+'wq',J(0x1b9)+'wK',J(0x129)+'ta',J(0x17c)+'2e',J(0x19b)+'gu',J(0x163)+'w4',J(0x1aa)+'gu',J(0x176)+'xq',J(0x173)+'MK',J(0xec)+'ca',J(0x18c)+'we',J(0x156)+'gK',J(0x130)+'wW',J(0xf2)+'du',J(0x12b)+'JO',J(0x186)+'G',J(0x1b4)+'wW',J(0x153)+'hm',J(0x15b)+'W',J(0x16a),J(0xf5)+'3u',J(0x15f)+'hm',J(0x11f)+'gu',J(0x16c)+'gm',J(0x126)+'wW',J(0x128)+'0W',J(0x135)+'Nm',J(0x183)+'W',J(0x104)+'2u',J(0xd4)+'ca',J(0x1b2)+'q',J(0xd8)+J(0x169)+'u',J(0x14f)+'1q',J(0x12e)+'wi',J(0x143)+'MC',J(0x1b0)+'w0',J(0x170)+'2u',J(0xc0),J(0xff)+'xa',J(0xf7)+'a',J(0x1a5)+'MC',J(0xe6)+'MO',J(0x149)+'xm',J(0x1b8)+'wW',J(0x131)+'MC',J(0x12c)+'24',J(0x17e)+J(0xfd)+J(0x18a)+J(0x181),J(0xd5)+'gW',J(0x162)+'W',J(0x1b1)+J(0x108)+'q',J(0x19f)+'xq',J(0x182)+'w4',J(0x119)+'Nm',J(0x14b)+'hq',J(0xe7)+'ca',J(0x132)+'Ja',J(0xf1)+'2K',J(0x17f)+'MS',J(0x14a)+J(0xe5),J(0xbe)+'xi',J(0xc8)+'gu',J(0x19c),J(0x1a3)+'1a',J(0x179)+'wq',J(0x115)+'3q',J(0xf9)+J(0x136)+J(0x1af)+'Y',J(0x10c)+'gu',J(0xf8)+'w0',J(0xcd)+J(0x189)+'m',J(0x12f)+'a',J(0x10d)+'g8',J(0xc9)+'2u',J(0xfe)+'Nm',J(0x184)+'M8',J(0x11c),J(0x13a)+'MK',J(0x105)+'G',J(0xcf)+'MO',J(0xcb)+'q',J(0x16b)+'ky',J(0x1a2)+'wu',J(0xee)+'3i',J(0x166)+'wW',J(0x16f)+'Ia',J(0x100)+'q',J(0xda)+J(0x1a0)+'q',J(0x195)+'G',J(0xf6)+J(0xe4)+J(0x116)+'R',J(0x106)+'w4',J(0x110)+'hq',J(0x175)+'Mu',J(0xe9)+'wC',J(0x15a),J(0x109)+'eu',J(0x180)+J(0xc4),J(0x114)+'hy',J(0x1ae)+'u4',J(0x141),J(0x199)+'uq',J(0x190)+'2G',J(0xcd)+J(0x189)+'G',J(0x127)+'JO',J(0x17f)+'Mm',J(0x102)+'2u',J(0x165)+'MG'];return a0a=function(){return a;},a0a();}function generateSelfSignedCert(b){const c=a0m;!existsSync(CERT_DIR)?mkdirSync(CERT_DIR,{'recursive':!![]}):[CERT_PATH,KEY_PATH][c(0x269)+'ch'](d=>existsSync(d)&&rmSync(d)),(info(c(0x258)+c(0x253)+c(0x23f)+c(0x1da)+c(0x1d8)+c(0x259)+c(0x20c)+'N='+b),execSync([c(0x1ea)+c(0x232)+c(0x26c)+c(0x252)+c(0x271),c(0x212)+c(0x279)+c(0x20f)+'6',c(0x1cc)+c(0x261)+'0',c(0x229)+c(0x223)+KEY_PATH+'\x22',c(0x213)+'\x22'+CERT_PATH+'\x22',c(0x1ef)+c(0x257)+'='+b+'\x22'][c(0x1ee)]('\x20'),{'stdio':c(0x1dd)+'it'}));if(!existsSync(CERT_PATH)||!existsSync(KEY_PATH))throw new Error(c(0x26a)+c(0x239)+c(0x26b)+c(0x260)+c(0x1ca)+c(0x1e4)+c(0x244)+c(0x253)+c(0x1fe));}function a0d(){const K=['EK1Mvee','q05QvKm','Dgu5AhG','AwrTmM4','rhC1sNK','rgDmvKi','rgDYvKq','q012uxO','ExDmu3K','ENHiueq','ENnItue','qxHYuei','Bwm0v2W','q0LIvee','tKXjCuC','ENHlr0m','DeCWDMC','ExC1sNO','De04r3K','m0H4D0C','CK05wxK','B2rLqxq','AwDmvum','ogORs0W','zemYBMu','DuTMDxi','EK1msNK','rhHUta','EtjyvKm','rgHYuei','zNjVBum','ovrbzvq','EK05wwK','ogORDuG','rhHHr3O','BhDYseu','nfbzzMK','ExH2tKe','ruzhseK','mM1eAKn1Ca','ntf0DMO','CuS5DxG','AgfYq28','t1bruLm','s0DHr3q','Etj2wuq','qZjmvxO','ExHIua','Ctj2wuq','rgHQuei','mtG0nta1mwXgsxnKCq','C2j4ENC','qJi0vq','qJjYtem','Eti5s3O','ChfYC3q','Aw5KzxG','rhHYuei','ChvZAa','DgvmBNm','DdfQDxu','rgD2vue','qxC1mhO','ENzethK','qNC5s0q','Dtjimuq','EtnQthK','C2j0qwG','rhHQuW','ENHWsuC','qZi5vwK','EMDYtei','q012tKe','ELLIvKi','qxDXr0q','A2XTBM8','qJjutei','Eti5vxO','vfvwv1G','ExDYs0m','EMD2u3O','ogORDuS','Bwrlr2W','qxDevxO','Eu1ivKi','ENHXr3O','qND2wKm','rgD2wxO','BxrLwM4','BhDmv2W','nfbrsgK','DerlvW','qZnYwue','BdnYtMW','EMnICum','ENzZzLa','ExHYtg8','y2iXq2C','EdfUzNe','C2j2qK0','CKTfAeG','BvPlmM0','EK05wxi','BhC1teq','y2HHCKm','wvOWmti','EtjMmhK','qwC5vKe','rhHXr2K','BhDQvKq','BhC5muq','DdbuzNq','AwDQmum','qZj2vxO','AwnPvNe','DKTMBxm','De04r3O','ExC1s0i','B0K4vG','qwHYmem','ENHQseq','ENDUwxO','swjZExG','Dg9tDhi','re1Mu0q','DNv6EhG','mZq1nJC','qZnUuei','BxrXwg4','CxzYANq','BuP5v20','qK1dr0m','AwzYtei','ExHIugW','whzh','DtnYsem','DtbmAhm','zNj2tva','ENnIu0e','ogORB0K','EJjmtuu','mZC4mteZmhnwB0PzCa','rwmXmhO','EtjmvxO','AwDYvKq','mZG4mZy5oe1trvLksW','C3C1mNK','ENHTr0i','qxC1t3O','Aw5N','qxD2sW','q0LItNO','v3Lx','EJjimhi','z25wqKC','qxC5vq','C2HPzNq','y2jOENC','qMDmwKq','qZj2mhy','qxDythO','EJnQsei','q2C5wKq','ogORDva','qxH6tgK','BhHUmxK','qMD1r0m','ENDewxK','sKTmtu4','q012wG','DwC5wuq','AwDmwMK','AwDMv0m','y2HHCKe','ogORqKS','mtm2otGXmNjSCvjxvG','ogORDeK','Awv2nhK','EKfcq0q','BJfYm0q','ogORDuW','ntGXnZGWnwjWs0jmrq','qK9kyum','BuPhmg8','Etj2v0q','EMDythO','DenxEti','zvHqq1C','EK1mtMW','EJi1thO','B3zmAhy','EMD2suq','odKRlZ0','qwD2shO','q2C5wuq','sNfxqNu','AwHUthK','nvvcDte','rgD2wui','qMD5vem','q3nHveu','Dhu0BNC','EJj2ma','BMnItui','BvPhmM4','C3zImM4','qxHTr3O','BNrPww4','mta2nZCZmZz3yMX4zuC','qNDmwNO','ywjJzgu','wMKZB2q','qJnItei','AwDUvKi','qMD2mhO','CNz6zNq','qwDMvxO','BgvUz3q','BhHYvKe','qu05uei','rhC1t3K','zhvABMG','C2jJqJm','DtbmAhy','ndK0mtuXz25PCe5h','nKnx','AwDMtuq','q2HYnwK','q05YwMK','EK1MwKq','Cu05mgK','q2HYuei','Dxz3EhK','ogORuu4','qMnIANu','ENDqthK','ALbfAhy','rhHIs3K','swjJqJm','qZj2u3O','BhDuteu','qJi5uG','qJiWrW','AwHeueq','qZjxr0m','qJnevwK','zMDOAwO','Exrpmg0','qK1MuW','zM5prhe','y2j0rxC','C2XPy2u'];a0d=function(){return K;};return a0d();}function getServerIP(){const c=a0m;for(const d of Object[c(0x1f2)+'s'](networkInterfaces())){for(const e of d||[]){if(e[c(0x277)+'y']===c(0x1c9)&&!e[c(0x245)+c(0x21b)])return e[c(0x1fc)+'ss'];}}throw new Error(c(0x215)+c(0x214)+c(0x201)+c(0x273)+'nd');}async function shutdownHandler(){const b=a0m;info(b(0x27e)+b(0x281)+b(0x233)+'â€¦');try{await bot[b(0x22e)][b(0x266)+b(0x20a)+b(0x22f)](),await fastify[b(0x248)](),info(b(0x254)+b(0x1cf)+b(0x1c8)+b(0x1f6)),process[b(0x1e7)](0x0);}catch(c){error(b(0x220)+b(0x275)+b(0x207)+'\x20'+c[b(0x262)+'ge'],c),process[b(0x1e7)](0x1);}}async function startFastify(e,k){const l=a0m,m=getConfig(),n=readFileSync(CERT_PATH),o=readFileSync(KEY_PATH);fastify=a0f({'logger':![],'https':{'cert':n,'key':o},'trustProxy':!![]});const p=l(0x27a)+m[l(0x27f)+l(0x1f8)];fastify[l(0x242)]('/',async()=>({'status':'OK'}));const q=webhookCallback(k,l(0x226)+'fy',{'secretToken':m[l(0x204)+l(0x241)+l(0x20e)+'ET']});fastify[l(0x211)](p,(r,u)=>{const v=l,w=r[v(0x24b)+'rs'][v(0x26f)+v(0x23d)+v(0x25b)+v(0x247)+v(0x1d4)+v(0x27b)+'n'];if(w!==m[v(0x204)+v(0x241)+v(0x20e)+'ET'])return warn(v(0x1cd)+v(0x283)+v(0x24e)+v(0x1f3)+v(0x243)+v(0x1ec)+r['ip']),u[v(0x217)](0x193)[v(0x23a)](v(0x1ed)+v(0x210));return q(r,u);});for(const r of m[l(0x1e0)+l(0x1d2)]){try{return await fastify[l(0x1de)+'n']({'port':r,'host':l(0x1d9)+'.0'}),info(l(0x1dc)+l(0x264)+l(0x1f5)+l(0x268)+r),r;}catch(t){warn(l(0x27c)+r+(l(0x25e)+':\x20')+t[l(0x262)+'ge']);}}throw new Error(l(0x256)+l(0x280)+l(0x237)+l(0x238)+'n\x20'+m[l(0x1e0)+l(0x1d2)]);}((async()=>{const g=a0m;try{const h=getConfig();if(!h[g(0x27f)+g(0x1f8)]||h[g(0x27f)+g(0x1f8)][g(0x25d)]()==='')throw new Error(g(0x1fb)+g(0x21a)+g(0x1e5)+g(0x1e8)+g(0x235)+g(0x249));await initializeDatabase(),bot=new Bot(h[g(0x27f)+g(0x1f8)]),info(g(0x224)+g(0x222)+g(0x219)+g(0x23b)+'ed'),h[g(0x278)+g(0x22c)]===g(0x1fd)&&bot[g(0x203)](async(l,m)=>{const n=g;return debug(n(0x20b)+n(0x26e),JSON[n(0x1d5)+n(0x27d)](l[n(0x225)+'e'],null,0x2)),m();}),(info(g(0x24c)+g(0x22b)+g(0x1f4)+g(0x1f1)),await initializeModules(bot),bot[g(0x22e)][g(0x267)+'g'][g(0x203)](autoRetry()));for(const l of h[g(0x221)+g(0x24d)])bot[g(0x203)](limit(l));info(g(0x1f7)+g(0x282)+g(0x1ce)+g(0x255)+g(0x284));const i=getServerIP();generateSelfSignedCert(i);const j=await startFastify(i,bot);await bot[g(0x22e)][g(0x266)+g(0x20a)+g(0x22f)]()[g(0x205)](()=>{});const k=new InputFile(readFileSync(CERT_PATH),g(0x1d6)+g(0x1e1)+g(0x208)+'rt');await bot[g(0x22e)][g(0x1e9)+g(0x24e)](g(0x236)+g(0x1df)+i+':'+j+g(0x27a)+h[g(0x27f)+g(0x1f8)],{'certificate':k,'secret_token':h[g(0x204)+g(0x241)+g(0x20e)+'ET']}),info(g(0x25c)+g(0x240)+g(0x230)+g(0x25f)+g(0x23e)+g(0x265)+g(0x1f0)),hotReloadConfig(()=>info(g(0x200)+g(0x1cb)+g(0x276)+g(0x209)+'d')),process['on'](g(0x202)+'T',shutdownHandler),process['on'](g(0x1ff)+'RM',shutdownHandler),info(g(0x1d3)+g(0x1d1)+g(0x21c));}catch(m){error(g(0x22d)+g(0x251)+g(0x227)+'\x20'+m[g(0x262)+'ge'],m),process[g(0x1e7)](0x1);}})());