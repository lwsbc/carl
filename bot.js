const a0m=a0b;function a0a(){const w=['u0Lhsu4','igrVD24','iev4y2u','C3rYAw4','mc4WlJa','8j+QNsbxzwi','AwqGD2u','BgLZDgu','zwPLy3q','idm2nta','DgrVD24','zM9Yiem','C3nPBMC','BwvZC2e','zxKGCNm','BwLZzsa','zsbSAw0','4PQHignVBG','mty2otjLzNj3t3i','y2vYDhm','8j+uHcbtEw4','BgyTC2K','qK9ux1q','yxbPlxm','DMfSDwu','y29Kzq','4PYfifnODq','AxrPBMC','8j+uLcb1Cgq','8j+uPsbvBMm','C2LUzYe','vuzxx1a','z2H0rxG','yxbP','8j+KLIbcB3q','zMfZDgK','ytO0mdK','oduWmteWm2frExnrtq','zMLJyxq','C2vSzNm','lwLWlMm','lwrHExm','ywLSywi','AwXLzdO','B29R','z2LMEq','Bgv0zq','mJGZmdG2BeHtvLvi','nZvMv1PusM8','oI8V','CMvQzwm','B3DUigu','B2rLCW','u3rHCNq','uKfurv8','zxpIGky','t0TftG','DgLVBJO','B3bLBNm','zwnYzxq','AwDUzwq','yxvNAhq','y2vWDgK','CMvZ','B2TLBIa','y2f0y2G','zM9Yrwe','te9hx0W','AgvHzgu','z3jHBq','zsbMAwW','8j+uKcbhzw4','C2WGCMu','zgrLBG','ifrLBgu','Aw9U','DgvYBMe','8j+uPsbvBMG','ignVBxa','ncbMB3u','DhrPBMC','BguGCg8','8j+tIIbsyxq','y3jLyxq','DhjPBq','yxrLoG','z25Lzca','DxrPBhm','lwjVDc0','zxmGBwK','lxn1yMO','AwvK','AM9PBG','otyXodi4qMrsD0T1','qvrjt04','CMvNAxm','iciVq04','rvzfta','zxjHDgK','igLUC3q','AxzLiq','y2LUzYa','lxrVA2u','DxbKyxq','8j+oIsbcB3q','lw5LD2S','Cg9YDca','Aw50zxi','zYbVBIa','u0Lhveu','zgXLzfi','CNjVCJO','CIbNzw4','ChrPB24','qM90ihq','Aw5Ozxi','mJaZotzQqvbns0K','Dw5Jyxu','y2XVC2u','Dw5Oyw4','BMCGC2u','zvDLyMG','CsaTEdu','Chr5ig8','ihnLy3i','mdKGlw4','igfWCgW','sw52ywW','svb2na','x1nfq1i','B24U','mtGXmtiXogHcte1nyq','zMfTAwW','zwDYyw0','DxqGiG','lwTLEw8','C29Uigm','B20G','zxHPDa','ndbvvLnfC3e','DxjS','z2v0','DgvUAw4','teLnsvq','tM8Gyxy','C2vUza','Ahr0Chm','zgvSzxq','C2v0v2u','yw5KBgu','tM8GzxG','DxnL','l3rNlW','DxaGzMe','CIbTAxm','4PYfieXPCW','y2vYDca','mtflyKLHyuy','Bcbjuhy','rM9YyMK','zgvIDwC','q2vYDgK','CNrZigK','yw5Jzsa','odrzsffVCfq','yMHVB2S','y29UzMK','Cg9ZDa','igj1C3K','igfMDgu','igLZigW','Ec10zwW','DgvYzwq','zxqGzNi','8j+BKsbtAhu','vKfmsuq','ywrKCMu','BMfS','AxmGzw0','ihDPDgG','zcbqCM8','lwLWlMS','Ag9VAYa','zMLNlMO','t1juuW','Bw9KDwW','ug9YDca','oty0mZmWDfnitKTO','lw91Dca','u2H1Dgq','AgfUz2u'];a0a=function(){return w;};return a0a();}(function(a,b){const l=a0b,c=a();while(!![]){try{const d=parseInt(l(0x22e))/0x1+parseInt(l(0x23d))/0x2+-parseInt(l(0x1cc))/0x3*(-parseInt(l(0x19f))/0x4)+-parseInt(l(0x1ea))/0x5*(parseInt(l(0x1e9))/0x6)+-parseInt(l(0x217))/0x7*(parseInt(l(0x245))/0x8)+parseInt(l(0x1df))/0x9+-parseInt(l(0x1b6))/0xa*(parseInt(l(0x198))/0xb);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x79278));import{Bot,webhookCallback,InputFile}from'grammy';import a0c from'fastify';import{readFileSync,existsSync,rmSync,mkdirSync}from'fs';import{execSync}from'child_process';import{networkInterfaces}from'os';function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0x188;let f=c[d];if(a0b['dnHotj']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0b['wSxibZ']=g,a=arguments,a0b['dnHotj']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0b['wSxibZ'](f),a[i]=f):f=j,f;},a0b(a,b);}import{dirname,join,resolve}from'path';import{fileURLToPath}from'url';import{info,warn,error,debug}from'./bookieutils/logger.js';import{getConfig,hotReloadConfig}from'./bookieutils/config.js';import{initializeModules}from'./bookieutils/loader.js';import{initializeDatabase}from'./bookieutils/db.js';import{autoRetry}from'@grammyjs/auto-retry';import{limit}from'@grammyjs/ratelimiter';const __dirname=dirname(fileURLToPath(import.meta[a0m(0x246)])),ROOT=resolve(__dirname),RES_DIR=join(ROOT,a0m(0x1f9)),CERT_DIR=join(RES_DIR,a0m(0x211),a0m(0x1cd)),CERT_PATH=join(CERT_DIR,a0m(0x1e1)+a0m(0x1f6)+a0m(0x1e2)+'rt'),KEY_PATH=join(CERT_DIR,a0m(0x1e1)+a0m(0x1f6)+a0m(0x1b0)+'ey');let bot,fastify;process['on'](a0m(0x231)+a0m(0x228)+a0m(0x1c2)+a0m(0x205),a=>{const n=a0m;error(n(0x207)+n(0x190)+n(0x1af)+n(0x1c9)+n(0x1ec)+n(0x1f3),a);}),process['on'](a0m(0x22f)+a0m(0x1da)+a0m(0x1f8)+'on',a=>{const o=a0m;error(o(0x1d7)+o(0x1f7)+o(0x1bc)+o(0x22b)+':',a);});function generateSelfSignedCert(a){const p=a0m;!existsSync(CERT_DIR)?mkdirSync(CERT_DIR,{'recursive':!![]}):[CERT_PATH,KEY_PATH][p(0x1fc)+'ch'](b=>existsSync(b)&&rmSync(b));info(p(0x201)+p(0x21c)+p(0x232)+p(0x1cf)+p(0x210)+p(0x197)+p(0x1c5)+'N='+a),execSync([p(0x1f4)+p(0x202)+p(0x234)+p(0x237)+p(0x1ee),p(0x223)+p(0x1c8)+p(0x1de)+'6',p(0x1e3)+p(0x1c3)+'0',p(0x241)+p(0x240)+KEY_PATH+'\x22',p(0x1b7)+'\x22'+CERT_PATH+'\x22',p(0x214)+p(0x21a)+'='+a+'\x22'][p(0x216)]('\x20'),{'stdio':p(0x22d)+'it'});if(!existsSync(CERT_PATH)||!existsSync(KEY_PATH))throw new Error(p(0x19c)+p(0x1e0)+p(0x200)+p(0x213)+p(0x1c6)+p(0x1a4)+p(0x22a)+p(0x21c)+p(0x23c));}function getServerIP(){const q=a0m;for(const a of Object[q(0x1d2)+'s'](networkInterfaces())){for(const b of a||[]){if(b[q(0x23e)+'y']===q(0x23a)&&!b[q(0x225)+q(0x1ac)])return b[q(0x1ab)+'ss'];}}throw new Error(q(0x191)+q(0x206)+q(0x199)+q(0x209)+'nd');}async function shutdownHandler(){const r=a0m;info(r(0x1a9)+r(0x20a)+r(0x1bb)+'â€¦');try{await bot[r(0x1db)][r(0x18e)+r(0x233)+r(0x1e6)](),await fastify[r(0x230)](),info(r(0x1d4)+r(0x1c4)+r(0x208)+r(0x1e8)),process[r(0x244)](0x0);}catch(a){error(r(0x1b8)+r(0x1ed)+r(0x229)+'\x20'+a[r(0x1c7)+'ge'],a),process[r(0x244)](0x1);}}async function startFastify(a,b){const s=a0m,c=getConfig(),d=readFileSync(CERT_PATH),f=readFileSync(KEY_PATH);fastify=a0c({'logger':![],'https':{'cert':d,'key':f},'trustProxy':!![]});const g=s(0x193)+c[s(0x1d0)+s(0x1f2)];fastify[s(0x188)]('/',async()=>({'status':'OK'}));const h=webhookCallback(b,s(0x1dd)+'fy',{'secretToken':c[s(0x1aa)+s(0x218)+s(0x23b)+'ET']});fastify[s(0x1a2)](g,(i,j)=>{const t=s,k=i[t(0x1fe)+'rs'][t(0x1a6)+t(0x23f)+t(0x212)+t(0x1d1)+t(0x1f5)+t(0x220)+'n'];if(k!==c[t(0x1aa)+t(0x218)+t(0x23b)+'ET'])return warn(t(0x239)+t(0x1c0)+t(0x1a0)+t(0x236)+t(0x1a8)+t(0x243)+i['ip']),j[t(0x1d3)](0x193)[t(0x18c)](t(0x19a)+t(0x203));return h(i,j);});for(const i of c[s(0x1d9)+s(0x1b3)]){try{return await fastify[s(0x1c1)+'n']({'port':i,'host':s(0x1be)+'.0'}),info(s(0x196)+s(0x189)+s(0x226)+s(0x224)+i),i;}catch(j){warn(s(0x1b5)+i+(s(0x1a3)+':\x20')+j[s(0x1c7)+'ge']);}}throw new Error(s(0x18b)+s(0x1e4)+s(0x20b)+s(0x19d)+'n\x20'+c[s(0x1d9)+s(0x1b3)]);}((async()=>{const u=a0m;try{const a=getConfig();if(!a[u(0x1d0)+u(0x1f2)]||a[u(0x1d0)+u(0x1f2)][u(0x20e)]()==='')throw new Error(u(0x22c)+u(0x1fa)+u(0x1ad)+u(0x235)+u(0x195)+u(0x1d8));await initializeDatabase(),bot=new Bot(a[u(0x1d0)+u(0x1f2)]),info(u(0x1dc)+u(0x21d)+u(0x19e)+u(0x20d)+'ed');a[u(0x1fd)+u(0x21b)]===u(0x19b)&&bot[u(0x192)](async(e,f)=>{const v=u;return debug(v(0x1d6)+v(0x20f),JSON[v(0x1bd)+v(0x1e7)](e[v(0x221)+'e'],null,0x2)),f();});info(u(0x1ce)+u(0x21f)+u(0x1b4)+u(0x1f1)),await initializeModules(bot),bot[u(0x1db)][u(0x1a1)+'g'][u(0x192)](autoRetry());for(const e of a[u(0x1f0)+u(0x18a)])bot[u(0x192)](limit(e));info(u(0x20c)+u(0x1ca)+u(0x1d5)+u(0x238)+u(0x215));const b=getServerIP();generateSelfSignedCert(b);const c=await startFastify(b,bot);await bot[u(0x1db)][u(0x18e)+u(0x233)+u(0x1e6)]()[u(0x1fb)](()=>{});const d=new InputFile(readFileSync(CERT_PATH),u(0x1e1)+u(0x1f6)+u(0x1e2)+'rt');await bot[u(0x1db)][u(0x18f)+u(0x1a0)](u(0x18d)+u(0x1eb)+b+':'+c+u(0x193)+a[u(0x1d0)+u(0x1f2)],{'certificate':d,'secret_token':a[u(0x1aa)+u(0x218)+u(0x23b)+'ET']}),info(u(0x1bf)+u(0x1b1)+u(0x219)+u(0x1a7)+u(0x1ae)+u(0x204)+u(0x1ff)),hotReloadConfig(()=>info(u(0x1cb)+u(0x1b2)+u(0x242)+u(0x1b9)+'d')),process['on'](u(0x1ba)+'T',shutdownHandler),process['on'](u(0x227)+'RM',shutdownHandler),info(u(0x222)+u(0x1a5)+u(0x21e));}catch(f){error(u(0x1ef)+u(0x194)+u(0x1e5)+'\x20'+f[u(0x1c7)+'ge'],f),process[u(0x244)](0x1);}})());