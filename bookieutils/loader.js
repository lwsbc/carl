const a0q=a0b;(function(a,b){const p=a0b,c=a();while(!![]){try{const d=-parseInt(p(0x137))/0x1+-parseInt(p(0x11d))/0x2*(-parseInt(p(0x16c))/0x3)+-parseInt(p(0x156))/0x4*(parseInt(p(0x11e))/0x5)+parseInt(p(0x108))/0x6+-parseInt(p(0xd9))/0x7+parseInt(p(0x1b0))/0x8+parseInt(p(0x1c9))/0x9*(parseInt(p(0x14e))/0xa);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x643e9));import{readdir,stat}from'fs/promises';import a0c from'path';function a0a(){const K=['AgfZ','EhrYytO','8j+uKIbhBg8','zM9Y','yMfSigi','C2v0','C29Uigm','ChjVzhu','igXPBwK','4P2mifDHDa','8j+uPsbdCMK','yM9VA2K','zwPLy3q','Bg9Hza','ig5VBI0','DgvKigy','BM90ige','zgf0yq','AM9PBG','AxrO','BM93','BgjHy2S','C2fNzs8','BMCGiM4','z2H0rxG','ywnRx3e','BIbWCM8','ig5VDca','4PYfieXVyq','8j+sPsbiyw4','4O+Zie1Vza','AxngAwW','BgvKihq','ChvZAa','zgLUzYa','zxHJzwu','DMvYC2K','CMvSB2e','uMvQzwm','igLUia','4PQG77Ipiev4yW','ndeXnJyWBuvsCKjk','Bg9Hzgu','zNvUy3q','ywLSzwq','B2r1Bgu','Aw9U','yw4GDxa','zMLSDgu','BwLZzsa','zNvSzMK','zxHWB3i','p3q9','zwXVywq','DgLJywW','y2HHBMC','zgvKicG','CNmGyxq','yw5Lzca','ywXPEMu','B3iGC2u','uMvKywm','mMLvDhbSvG','nwjfEgzhva','Aw5Nig0','ig1ZzYW','DgfJAgu','zgv2zwW','z2v0','zcdIHPiGCG','ywXS','BMfTzq','8j+uPYbiyw4','igvYCM8','B2fKzwq','CMvZB2W','ywnRuxu','zgXLCNm','yw5KBgu','zxjZAw8','DgLVBG','B25nzxm','4PM777IpifjLBa','C29YDa','8j+NQsbnB2q','zwvKzwq','iJOG','C3rLBMu','nJu5otqYBhbbrfD4','ignI','AxnZDwu','iM9Uq2e','zxjYB3i','CMfJzq','D2f0y2G','BYbJBgu','zxHPDa','DhmGkgK','igfMDgu','zgvSzxq','zcdIHPiG','AhjLzG','y3vYAxq','CNrZigu','BgvYigy','zw5KC1C','AgfUz2u','zsbOyw4','yMLUza','DwXLCYa','BgLKig0','mJe1mJC0mhvzD2v6vW','yw1LiG','B25dywW','4PQG77Ipie1Vza','CMvWBge','iev4y2u','Dw5Jyxu','iM9Utwu','mJG1nZeYnhPUwvbytq','ChrPB24','4PUuifnRAq','zMfPBgu','B2fKzxi','Aw1PDca','A3mUAw4','DgLHBgK','BwfW','EMvKia','AxrOigm','DhrSzwq','y2HLCIa','zcbVDxq','zsbYzwW','zw50CNK','zxzLBNq','zdOG','BwvZC2e','iIbPCYa','lI4VyM8','BgvUz3q','odyZndyZAgDOBMzR','igzHAwW','8j+APIbmB2e','zgvZ','mtaWkYa','z3jLC3m','CMLUzW','AxrPywW','yw1L','CMvUy3K','BM8GDxm','zxj5','BIb0CMK','B3bTzw4','BgXLza','igfSCMu','BwLZC2K','zgXLCIa','BML0Awe','8j+uPsbvBMG','zcbqCM8','zgvK','ihbYB3q','tK9erv8','z2DLCMu','ihjLywq','DwXLia','y2fSBgi','CgrHDgu','zMLSzsa','uxvLCNK','CMXVywq','zMLNlMO','8j+NUsbdBgu','zxnZAxy','y2XLyxi','C3vI','Dw5Oyw4','yxvNAhq','yMfZzw4','AxPLza','tw9KDwW','CZOG','C3rHDhu','yMvMB3i','DxjS','ihjLz2K','C3vIC3q','8j+xKE+4JYbvBMW','lMPZ','Bw9KDwW','zNvSBca','8j+BKsbnB2q','ig1Vzhu','ywr5igK','Dw5SAw4','8j+AGcbnB2q','DwXLigW','BMCGiNy','Dgv4Da','ywjSzsa','BgfZDfi','zs5OB28','Axr5','B3qGBgK','CNrPBMC','zgLYBMe','ihrPBwu','ndC5mdeWnePzuur5uW','zsbVDMu','C2L6zq','Aw5Nihi','DwXLihi','BgXIywm','BgvZihC','zwqGB24','y2XLyw4','B2TPzxm','CIbKDxi','ihvWzge','zw52','ChjPB3i','zwn0Aw8','y3rPB24','ChbPBMC','A1f1zxi','A2v5CW','Aw5JBhu','BgL6zs8','DgvKoIa','ru5w','igz1BgW','zxmP','mZzAB0foEKW','4PQHignVBG','8j+uHcbtDge','igLUDMe','y2vWDgK','4O+X77IpieLUAq','Aw4G','EsiGAxm','zgXLzfi','DwvYEtO','B3DUihu','BguGCMu','ywXSu2u','C2fNzq','C3rLCMu','DxaG','ysbMDw4','igHHBMq','ywrK','zvjLBg8','B25JDxi','8j+uPsbvBMm','B2fK','igHHCYa','DMfSDwu','w3vUA24','C3nHz2u','4P2miezHAq','mJiWmJyYEhjdshnV','Aw5PDgK','ihn1y2m','igz1BMm','8j+tPIbnB2q','igv4Cg8'];a0a=function(){return K;};return a0a();}import a0d from'chokidar';import{fileURLToPath,pathToFileURL}from'url';import a0e from'p-limit';import{info,error,warn,debug}from'./logger.js';import{hotReloadConfig}from'./config.js';const __dirname=a0c[a0q(0x1ae)+'me'](fileURLToPath(import.meta[a0q(0x199)])),BOOKIES_DIR=a0c[a0q(0x12a)+'ve'](__dirname,a0q(0x16a)+a0q(0x1b9)),BOT_HOOKS_KEY=Symbol[a0q(0xe2)](a0q(0xea)+a0q(0x1aa)+a0q(0x15c)+a0q(0x173)+a0q(0x194)),CONCURRENCY_LIMIT=0x5,LOAD_TIMEOUT=0x1388,RELOAD_DEBOUNCE=0xfa,ENV=process[a0q(0x1bc)][a0q(0x183)+a0q(0x1c6)]||a0q(0x122)+a0q(0x179)+'t',MAX_HANDLERS_WARNING=0x32;function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0xd4;let f=c[d];if(a0b['DvrLIo']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0b['naevxi']=g,a=arguments,a0b['DvrLIo']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0b['naevxi'](f),a[i]=f):f=j,f;},a0b(a,b);}let modules=new Map(),messageHandlers=[],callbackHandlers=[];const concurrencyLimiter=a0e(CONCURRENCY_LIMIT),fileTimers=new Map();let isReloading=![];export const moduleStatus={'loaded':[],'failed':[],'lastReload':Date[a0q(0xf3)]()};function sanitizeError(a){const r=a0q;if(ENV===r(0xe6)+r(0x1bf))return{'name':a[r(0x126)],'message':a[r(0x168)+'ge'],'stack':r(0x11c)+r(0xee)+r(0x11b)+r(0x145)+'y'};return a;}function updateHandlers(){const s=a0q;messageHandlers=[],callbackHandlers=[];const a=[...modules[s(0xd5)+'s']()][s(0x132)]((c,d)=>(d[s(0x1bd)+s(0x1ab)]??0x0)-(c[s(0x1bd)+s(0x1ab)]??0x0));for(const {mod:b}of a){typeof b[s(0x130)+s(0x1d6)]===s(0x10a)+s(0x10d)&&messageHandlers[s(0x100)]({'handler':b[s(0x130)+s(0x1d6)][s(0x14b)](b),'module':b[s(0x126)]}),typeof b[s(0x150)+s(0xf4)+s(0x18a)]===s(0x10a)+s(0x10d)&&callbackHandlers[s(0x100)]({'handler':b[s(0x150)+s(0xf4)+s(0x18a)][s(0x14b)](b),'module':b[s(0x126)]});}(messageHandlers[s(0x16b)+'h']>MAX_HANDLERS_WARNING||callbackHandlers[s(0x16b)+'h']>MAX_HANDLERS_WARNING)&&warn(s(0x107)+s(0x18e)+s(0x14a)+s(0x12c)+s(0x19a)+s(0x1d7)+s(0x167)+(messageHandlers[s(0x16b)+'h']+(s(0x120)+'\x20')+callbackHandlers[s(0x16b)+'h']+s(0x138))),info(s(0x127)+s(0x12c)+s(0x1bb)+s(0x1c5)+messageHandlers[s(0x16b)+'h']+(s(0x120)+'\x20')+callbackHandlers[s(0x16b)+'h']+s(0x138));}function timeout(a,b,c){const t=a0q;return Promise[t(0x13c)]([a,new Promise((d,e)=>{setTimeout(()=>{const u=a0b;e(new Error(c+(u(0x1af)+u(0x163)+u(0x141)+'r\x20')+b+'ms'));},b);})]);}function validateModule(a,b){const v=a0q,c=a[v(0x126)]||b,d=[];if(!a[v(0x126)])d[v(0x100)](v(0x17c)+v(0xf6)+v(0x14f));if(!a[v(0x103)+'on'])d[v(0x100)](v(0x17c)+v(0x1a6)+v(0x12e)+'n\x22');typeof a[v(0xda)+v(0x11a)]!==v(0x10a)+v(0x10d)&&typeof a[v(0x130)+v(0x1d6)]!==v(0x10a)+v(0x10d)&&typeof a[v(0x150)+v(0xf4)+v(0x18a)]!==v(0x10a)+v(0x10d)&&d[v(0x100)](v(0x176)+v(0x1a8)+v(0x112)+v(0x140)+v(0x17e)+v(0x1c4)+v(0x130)+v(0xf5)+v(0x150)+v(0xf4)+v(0x18a)+')');a[v(0x130)+v(0x1d6)]&&typeof a[v(0x130)+v(0x1d6)]!==v(0x10a)+v(0x10d)&&d[v(0x100)](v(0x155)+v(0xd7)+v(0x169)+v(0xef)+v(0xdc)+v(0x12f));a[v(0x150)+v(0xf4)+v(0x18a)]&&typeof a[v(0x150)+v(0xf4)+v(0x18a)]!==v(0x10a)+v(0x10d)&&d[v(0x100)](v(0x13a)+v(0x1b5)+v(0x1c1)+v(0x1d0)+v(0xfa)+v(0x1d9)+v(0x1bf));if(d[v(0x16b)+'h'])return warn(v(0x151)+v(0x186)+c+(v(0xd4)+v(0x139)+v(0x196))+d[v(0xf1)](',\x20')),![];const e=[v(0x126),v(0x103)+'on',v(0x1bd)+v(0x1ab),v(0xda)+v(0x11a),v(0x130)+v(0x1d6),v(0x150)+v(0xf4)+v(0x18a),v(0x1b8)+'up',v(0x198)+v(0x1dc)+'ad'],f=Object[v(0x1c2)](a)[v(0x10f)+'r'](g=>!e[v(0x1c3)+v(0x16f)](g));return f[v(0x16b)+'h']&&debug(v(0x133)+v(0x186)+c+(v(0xde)+v(0x146)+v(0xe0)+'\x20')+f[v(0xf1)](',\x20')),!![];}async function unloadModule(a,b=a0q(0x104)+'d'){const w=a0q;if(!modules[w(0xdf)](a))return;const {mod:c}=modules[w(0x123)](a);try{typeof c[w(0x1b8)+'up']===w(0x10a)+w(0x10d)&&(await c[w(0x1b8)+'up'](),debug(w(0x18d)+w(0x119)+w(0x1d8)+c[w(0x126)]));}catch(d){error(w(0xd8)+w(0xff)+w(0x13e)+w(0x10e)+'\x20'+c[w(0x126)]+':\x20'+d[w(0x168)+'ge'],sanitizeError(d));}finally{modules[w(0x142)+'e'](a),info(w(0x19c)+w(0x129)+'\x20'+c[w(0x126)]+'\x20('+b+')');}}async function loadFile(a,b=![],c=null){const x=a0q,d=a0c[x(0xf1)](BOOKIES_DIR,a),f=a0c[x(0x193)+x(0x174)](a,x(0x19d));try{const g=await stat(d);if(!g[x(0xfe)+'e']())return warn(x(0x158)+x(0x1c0)+x(0xed)+x(0x189)+x(0x165)+':\x20'+a),![];if(b&&modules[x(0xdf)](f)){const {mod:k}=modules[x(0x123)](f);typeof k[x(0x198)+x(0x1dc)+'ad']===x(0x10a)+x(0x10d)&&await k[x(0x198)+x(0x1dc)+'ad']();}const h=pathToFileURL(d)[x(0x144)]+x(0x113)+Date[x(0xf3)](),i=await import(h);if(!validateModule(i,a))return warn(x(0x158)+x(0x1c0)+x(0x1cc)+x(0x14d)+x(0x10c)+':\x20'+a),![];const j=i[x(0x126)]||f;b&&modules[x(0xdf)](f)&&await unloadModule(f,x(0x198)+x(0x164)+x(0x1df));if(typeof i[x(0xda)+x(0x11a)]===x(0x10a)+x(0x10d)&&c){const l=Date[x(0xf3)]();await timeout(i[x(0xda)+x(0x11a)](c),LOAD_TIMEOUT,j);const m=Date[x(0xf3)]()-l;debug(x(0x1ce)+x(0x15d)+x(0x15f)+j+x(0x106)+m+'ms');}return modules[x(0xe4)](f,{'mod':i,'priority':i[x(0x1bd)+x(0x1ab)]||0x0}),moduleStatus[x(0x109)+'d']=moduleStatus[x(0x109)+'d'][x(0x10f)+'r'](n=>n[x(0x126)]!==j),moduleStatus[x(0x109)+'d'][x(0x100)]({'name':j,'version':i[x(0x103)+'on']||'?','file':a,'loadedAt':Date[x(0xf3)]()}),info((b?x(0x131)+x(0x129):x(0xfb)+x(0x181))+'\x20'+j+'\x20v'+(i[x(0x103)+'on']||'?')),!![];}catch(n){const o=b?x(0x104)+'d':x(0xec);return error(x(0xd8)+x(0xff)+'o\x20'+o+'\x20'+f+':\x20'+n[x(0x168)+'ge'],sanitizeError(n)),moduleStatus[x(0x159)+'d'][x(0x100)]({'file':a,'error':n[x(0x168)+'ge'],'timestamp':Date[x(0xf3)]()}),modules[x(0x142)+'e'](f),![];}finally{updateHandlers();}}async function safeRunHandlers(a,b){const y=a0q;if(!a||a[y(0x16b)+'h']===0x0)return;for(const {handler:c,module:d}of a){if(typeof c!==y(0x10a)+y(0x10d))continue;try{const e=c(b);if(e instanceof Promise)await e;}catch(f){const g=b?.[y(0x168)+'ge']?.[y(0x1a7)]?.[y(0x19b)+y(0x172)](0x0,0x32)||b?.[y(0x187)+y(0x12b)+y(0x177)]?.[y(0xf0)]?.[y(0x19b)+y(0x172)](0x0,0x32)||y(0xd6)+y(0x1d3)+y(0x188)+']';error(y(0xfc)+y(0x17d)+y(0x1cf)+d+(y(0x16d)+y(0x1b7)+'\x20\x22')+g+y(0x135)+f[y(0x168)+'ge'],sanitizeError(f));}}}async function loadAllModules(a){const z=a0q;moduleStatus[z(0x109)+'d']=[],moduleStatus[z(0x159)+'d']=[];const b=(await readdir(BOOKIES_DIR))[z(0x10f)+'r'](g=>g[z(0x148)+z(0xf2)](z(0x19d))),c=b[z(0x15e)](g=>concurrencyLimiter(()=>loadFile(g,![],a)));debug(z(0x16e)+z(0x101)+c[z(0x16b)+'h']+(z(0x1a1)+z(0x1b6)+z(0x160)+z(0x1dd)+z(0x175)+z(0xe7)+'t\x20')+CONCURRENCY_LIMIT);const d=await Promise[z(0x1d5)+z(0x161)](c),e=d[z(0x10f)+'r'](g=>g[z(0x197)+'s']===z(0x111)+z(0x17a)&&g[z(0xd5)])[z(0x16b)+'h'],f=d[z(0x16b)+'h']-e;return info(z(0xdd)+z(0x14c)+z(0x109)+z(0x143)+e+(z(0xdb)+z(0x134)+',\x20')+f+(z(0x16d)+'ed')),moduleStatus[z(0x1a9)+z(0x114)]=Date[z(0xf3)](),{'success':e,'failed':f};}async function reloadAllModules(a){const A=a0q;if(isReloading){warn(A(0xfd)+A(0x1b4)+A(0x114)+A(0x17b)+A(0x1a2)+A(0xf9)+A(0x171));return;}try{isReloading=!![],info(A(0x1cb)+A(0x1ad)+A(0x1c7)+A(0x1a1)+A(0x1d4)+A(0xec));const b=new Map(modules);return modules[A(0x18f)](),updateHandlers(),await Promise[A(0x1d5)+A(0x161)]([...b[A(0x1c2)]()][A(0x15e)](c=>unloadModule(c,A(0x19f)+A(0x104)+'d'))),await loadAllModules(a);}catch(c){error(A(0xe9)+A(0x115)+A(0x128)+A(0x1ba)+A(0x1b3)+A(0x114)+':',sanitizeError(c));throw c;}finally{isReloading=![];}}async function setupWatchers(a){const B=a0q,b=a0d[B(0x13d)](BOOKIES_DIR,{'ignoreInitial':!![],'persistent':!![],'ignorePermissionErrors':!![],'atomic':0x1f4,'awaitWriteFinish':{'stabilityThreshold':0x12c,'pollInterval':0x64},'ignored':a0c[B(0xf1)](BOOKIES_DIR,B(0x190),'**')});b['on'](B(0x125),(c,d)=>{const C=B;try{if(!d[C(0x148)+C(0xf2)](C(0x19d)))return;const f=a0c[C(0x193)+C(0x174)](d),g=c+'-'+d;fileTimers[C(0xdf)](g)&&clearTimeout(fileTimers[C(0x123)](g)),fileTimers[C(0xe4)](g,setTimeout(()=>{const D=C;fileTimers[D(0x142)+'e'](g);try{if(c===D(0x1a3)+'k'){const h=f[D(0x152)+'ce'](/\.js$/,'');unloadModule(h);}else[D(0x1db),D(0x116)+'e'][D(0x1c3)+D(0x16f)](c)&&concurrencyLimiter(()=>loadFile(f,!![],a));}catch(i){error(D(0xe8)+D(0x162)+D(0x13b)+':\x20'+i[D(0x168)+'ge'],sanitizeError(i));}},RELOAD_DEBOUNCE));}catch(h){error(C(0xe8)+C(0x162)+C(0x166)+C(0x1da)+C(0x147)+C(0x10b)+':\x20'+h[C(0x168)+'ge'],sanitizeError(h));}}),hotReloadConfig(()=>{const E=B;info(E(0x1ca)+E(0x18c)+E(0xe5)+E(0x149)+E(0x124)+E(0x114)+E(0x11f)+E(0x10c)+'s'),concurrencyLimiter(()=>reloadAllModules(a));}),process['on'](B(0x191)+B(0x1d1)+B(0xeb)+B(0x10d),c=>{const F=B;error(F(0x17f)+F(0x12d)+F(0x180)+F(0x110)+F(0x105)+F(0x12f),sanitizeError(c)),ENV===F(0xe6)+F(0x1bf)&&c instanceof Error&&process[F(0x13f)](0x1);}),process['on'](B(0x154)+B(0xf7)+B(0x1cd)+'on',c=>{const G=B;error(G(0x1de)+G(0x192)+G(0x153)+G(0x157),sanitizeError(c)),process[G(0x13f)](0x1);});}export async function initializeModules(a){const H=a0q;!a[BOT_HOOKS_KEY]&&(a['on'](H(0x168)+'ge',b=>safeRunHandlers(messageHandlers,b)),a['on'](H(0x187)+H(0xf8)+H(0x1d2)+H(0xf0),b=>safeRunHandlers(callbackHandlers,b)),a[BOT_HOOKS_KEY]=!![],info(H(0xe1)+H(0xe3)+H(0x1ac)+H(0x136)+H(0x118)+H(0x121)+'d')),await loadAllModules(a),await setupWatchers(a),info(H(0x1a4)+H(0x1a5)+H(0x15a)+H(0x185)+'y');}export function getModuleStatus(){const I=a0q;return{...moduleStatus,'loadedCount':moduleStatus[I(0x109)+'d'][I(0x16b)+'h'],'failedCount':moduleStatus[I(0x159)+'d'][I(0x16b)+'h'],'reloadInProgress':isReloading};}export function assertModuleHealth(){const J=a0q;if(modules[J(0x1b2)]>0x64){error(J(0x1a0)+J(0x1a5)+J(0x15b)+J(0x102)+J(0x117)+J(0x170)+J(0x19e)+J(0x1c8));throw new Error(J(0x195)+J(0x1b1)+J(0x18b)+J(0x182)+J(0x1be)+J(0x178)+J(0x184)+'d');}}