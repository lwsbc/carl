const a0t=a0b;(function(a,b){const s=a0b,c=a();while(!![]){try{const d=parseInt(s(0x256))/0x1+parseInt(s(0x239))/0x2*(parseInt(s(0x215))/0x3)+-parseInt(s(0x265))/0x4+-parseInt(s(0x1d8))/0x5+-parseInt(s(0x20a))/0x6*(parseInt(s(0x1d0))/0x7)+parseInt(s(0x269))/0x8*(-parseInt(s(0x206))/0x9)+parseInt(s(0x261))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x1a25f));import{error,info}from'../bookieutils/logger.js';import{getConfig}from'../bookieutils/config.js';import{db}from'../bookieutils/db.js';import{getDefault,getConnection}from'../bookieutils/connection.js';import{applyFont,registerModule}from'../bookieutils/helpeutils/fonthelp.js';export const name=a0t(0x1df)+a0t(0x1f2);function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0x1c7;let f=c[d];if(a0b['OPxZDq']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0b['RaKDQX']=g,a=arguments,a0b['OPxZDq']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0b['RaKDQX'](f),a[i]=f):f=j,f;},a0b(a,b);}export const version=a0t(0x263);registerModule(name);function a0a(){const B=['zxiG','jYbUB3q','ChvZAa','BMfTzq','igLUAxq','l2zPBhq','zNjVBq','BgvUz3q','mtyWoti0DLHmt2Hr','zwqU','DxjS','zM91BMq','z19QC28','DgvKlG','zYbMAwW','pgi+','B25Uzwm','AwqGpsa','CgfYC2u','pc9IpI4','Aw5JBhu','BM90igm','zw50CMK','y2HHDa','4PYfieDLDa','AM9PBG','CIb2','lcbMAwW','DcbJB24','zsbJAge','pc9JB2q','CMvZCg8','ignOzwm','yxbP','CMvWBhK','Bgf5B3u','C3vIC3q','mtm2nZfLEhHUEei','yxvSDca','y2HHDf8','ieDLDgy','vcbJB24','zMfPBgu','BgLHC08','zNjVBsa','yxq6ia','Awv2Aw4','z2v0','ntmWotuZme1nEfnLDq','y2uGCMu','ms4WlJa','B3iGCMu','ndmYnde2tK1nvuvR','DgvYigq','igLUigm','CMvWBge','mZyYmdbIsKfZzwW','oIaVz2u','uK9nigy','DgLVBIa','C29SDMK','Aw5PDca','jMD0oW','BwvZC2e','x19PC0e','CxvPCMu','B3jPEMu','CMLUzW','mtm1nJGZogXuzxf0za','yNv0Dg8','C3bSAxq','CM9YoIa','Dgv4Da','AxnbCNi','jMX0oW','BhrLCIa','ndy5mZuWvu1tz05m','jImWmZK','CML2yxq','BNn0yw4','AYbLCNi','zgvZ','ChjPDMe','r2v0zMK','Aw5Nigq','BMCGy2G','BMvJDgK','qwrTAw4','DxjLzca','ihjLDhi','zMLNx2O','C29Uiey','BMqGzxi','zwzHDwW','ig5VDca','zxjYB3i','DgvYia','C29YDa','zMLSDgu','Dg9mB3C','rca8yJ4','ywXPyxm','BhrLCG','qM90igK','B25MAwC','l2DLDgy','BNnLCW','reiGzM8','CIbJAge','zwzPBMK','ig9Jy3u','zxjdyxm','CNjLzdO','DhLWzq','AwDZifC','zw50Axq','cI4UlIa','x2nVBMy','sevsrsa','DgvYici','zxiGpgy','4P2miefUia','mJqZvMnqvNbQ','C3rYAw4','CK5HBwu','khrYDw4','nNDfD3jUza','igf1DgG','AwfSAxO','4P2miezPBa','pc9IpIi','u0vmrum','BwfZDgu','vxnHz2u','4P2mie5Via','jNf1B3q','y29TBwe','m1vLAwvpDa','BMfTzt4','B3vWigm','C2v0','B3iGAw4','z3jVDxa','BhqGz3i','zgvMyxu','zdOG','4P2mievYCG','4P2mierLzG','y2f0zwq','Agf0ieK','DgzPBhq','sfrnta','zcbVCIa','AwvZ','pgnVzgu','zM9Yiha','B24GAw4','jMfTCdS','igDLDhq','igzVDw4','BwfW','8j+AQYboB3q','y29UzMK','AwX0zxi','rxjYB3i'];a0a=function(){return B;};return a0a();}let botApi=null;function isAdmin(a){const u=a0t;try{const {ADMINS:ADMINS=[]}=getConfig();return!!a[u(0x237)]?.['id']&&Array[u(0x1d5)+'ay'](ADMINS)&&ADMINS[u(0x245)+u(0x1dd)](a[u(0x237)]['id']);}catch(b){return error(u(0x1e3)+u(0x251)+u(0x1dc)+u(0x219)+u(0x259)+u(0x22f)+':\x20'+b[u(0x1cb)+'ge']),![];}}function escapeHtml(a){const v=a0t;return a[v(0x268)+'ce'](/&/g,v(0x229))[v(0x268)+'ce'](/</g,v(0x1d6))[v(0x268)+'ce'](/>/g,v(0x1ca))[v(0x268)+'ce'](/"/g,v(0x213)+';')[v(0x268)+'ce'](/'/g,v(0x1d9)+';');}function rehydrateChatFilters(a){const w=a0t,b=new Map();for(const c in a){const d=a[c];if(d){d[w(0x250)+w(0x1f6)]?d[w(0x250)+w(0x1f6)]=d[w(0x250)+w(0x1f6)][w(0x22c)](e=>{const x=w;if(typeof e===x(0x207)+'g')return{'text':e,'entities':[]};if(!Array[x(0x1d5)+'ay'](e[x(0x1ff)+x(0x225)]))e[x(0x1ff)+x(0x225)]=[];return e;}):d[w(0x250)+w(0x1f6)]=[];if(!d[w(0x1d1)+'ns'])d[w(0x1d1)+'ns']=[];if(!d[w(0x254)+'t'])d[w(0x254)+'t']=[];}else d={'responses':[],'buttons':[],'layout':[]};b[w(0x218)](c,d);}return b;}async function getFilterDefinitionFromDb(a,b){const y=a0t;try{const c=await db[y(0x260)](y(0x20f)+y(0x25a)+y(0x1e6)+y(0x1e7)+y(0x26b)+y(0x22f)+y(0x201)+y(0x1fe)+y(0x202)+y(0x258)+y(0x242)+'?',a);if(!c)return null;const d=JSON[y(0x243)](c[y(0x22e)+y(0x23d)+'n']),f=rehydrateChatFilters(d),g=b[y(0x1ef)+y(0x1fb)+'e']();let h=g;const i=f[y(0x260)](g);if(i&&i[y(0x1cc)+y(0x25c)+'f'])h=i[y(0x1cc)+y(0x25c)+'f'];else{if(!i)return null;}const j=f[y(0x260)](h);if(!j||j[y(0x1cc)+y(0x25c)+'f'])return null;const k=[];for(const [l,m]of f[y(0x247)+'es']()){m[y(0x1cc)+y(0x25c)+'f']===h&&k[y(0x233)](l);}return{'masterName':h,'aliases':k,'responses':j[y(0x250)+y(0x1f6)]||[],'buttons':j[y(0x1d1)+'ns']||[],'layout':j[y(0x254)+'t']||[]};}catch(n){return error(y(0x230)+y(0x1e5)+y(0x25f)+y(0x23f)+y(0x266)+y(0x1f9)+y(0x1c7)+y(0x25d)+y(0x1f7)+y(0x1f8)+'t\x20'+a+(y(0x24c)+y(0x1ec))+b+':\x20'+n[y(0x1cb)+'ge'],n),null;}}export async function onMessage(a){const z=a0t;if(!botApi)botApi=a[z(0x252)];const b=a[z(0x1cb)+'ge']?.[z(0x1d4)]||'',c=b[z(0x1ef)+z(0x1fb)+'e']()[z(0x1d2)]('\x20')[0x0],d=a[z(0x237)]?.['id'],f=a[z(0x248)][z(0x1fd)],g=a[z(0x248)]['id'];if(c===z(0x1f5)+z(0x22f)){if(!isAdmin(a))return a[z(0x253)](await applyFont(name,z(0x22d)+z(0x20b)+z(0x1ce)+'d.'));const h=b[z(0x1d2)]('\x20');if(h[z(0x238)+'h']<0x2)return a[z(0x253)](await applyFont(name,z(0x211)+z(0x26a)+z(0x222)+z(0x204)+z(0x22f)+z(0x216)));const i=h[0x1][z(0x1ef)+z(0x1fb)+'e']();let j=g;if(f===z(0x1de)+'te')try{const k=await getDefault();if(k){const l=await getConnection(k);if(l)j=l;else return a[z(0x253)](await applyFont(name,z(0x21f)+z(0x257)+z(0x21a)+'\x20\x27'+k+(z(0x232)+z(0x22b)+z(0x224)+z(0x246)+z(0x241)+z(0x23e))));}else return a[z(0x253)](await applyFont(name,z(0x212)+z(0x21c)+z(0x21b)+z(0x217)+z(0x1f4)+z(0x1e4)+z(0x227)+z(0x1da)+z(0x24e)+'t.'));}catch(m){return error(z(0x230)+z(0x22a)+z(0x1e0)+z(0x1e9)+z(0x24d)+z(0x1e2)+z(0x228)+z(0x259)+z(0x22f)+':\x20'+m[z(0x1cb)+'ge']),a[z(0x253)](await applyFont(name,z(0x21e)+z(0x264)+z(0x1c8)+z(0x1e1)+z(0x25e)+m[z(0x1cb)+'ge']));}try{const n=await getFilterDefinitionFromDb(j,i);if(!n)return a[z(0x253)](await applyFont(name,z(0x20d)+z(0x203)+z(0x240)+escapeHtml(i)+(z(0x20e)+z(0x1ea)+z(0x23c)+z(0x267)+z(0x221)+z(0x1f0))+j+z(0x244)),{'parse_mode':z(0x223)});let o=z(0x236)+z(0x231)+n[z(0x210)+z(0x208)];n[z(0x1f1)+'es']&&n[z(0x1f1)+'es'][z(0x238)+'h']>0x0&&(o+=','+n[z(0x1f1)+'es'][z(0x1ed)]()[z(0x24a)](','));o+='\x0a';for(const p of n[z(0x250)+z(0x1f6)]){o+='!'+p[z(0x1d4)]+'\x0a';}if(n[z(0x1d1)+'ns']&&n[z(0x1d1)+'ns'][z(0x238)+'h']>0x0){n[z(0x254)+'t']&&n[z(0x254)+'t'][z(0x238)+'h']>0x0&&!(n[z(0x254)+'t'][z(0x238)+'h']===0x1&&n[z(0x254)+'t'][0x0]===n[z(0x1d1)+'ns'][z(0x238)+'h'])?o+=z(0x1d1)+'n\x20'+n[z(0x254)+'t'][z(0x24a)](':')+'\x0a':o+=z(0x1d1)+'n\x20'+n[z(0x1d1)+'ns'][z(0x238)+'h']+'\x0a';for(const q of n[z(0x1d1)+'ns']){o+='?'+q[z(0x234)]+'('+q[z(0x23b)]+')\x0a';}}return o[z(0x238)+'h']>0xfa0&&(o=o[z(0x255)+z(0x1cf)](0x0,0xfa0-0x32)+(z(0x200)+z(0x209)+z(0x220)+')')),a[z(0x253)](z(0x226)+'>'+escapeHtml(o)+(z(0x24f)+'e>'),{'parse_mode':z(0x223)});}catch(r){return error(z(0x1df)+z(0x1d7)+z(0x214)+z(0x1e8)+z(0x1d3)+r[z(0x1cb)+'ge'],r),a[z(0x253)](await applyFont(name,z(0x205)+z(0x1eb)+z(0x1fa)+z(0x1fc)+'\x20'+r[z(0x1cb)+'ge']));}}}export async function initialize(a){const A=a0t;try{if(!a?.[A(0x252)])throw new Error(A(0x1f3)+A(0x1db)+A(0x262)+A(0x1cd)+'d.');botApi=a[A(0x252)],a['on'](A(0x1cb)+'ge',onMessage),info(A(0x249)+A(0x1ee)+A(0x24b)+version+(A(0x235)+A(0x20c)+A(0x23a)));}catch(b){error(A(0x1df)+A(0x1d7)+A(0x1c9)+A(0x25b)+A(0x21d)+b[A(0x1cb)+'ge']);throw b;}}