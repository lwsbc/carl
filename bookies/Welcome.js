const a0q=a0b;(function(a,b){const p=a0b,c=a();while(!![]){try{const d=-parseInt(p(0x29e))/0x1*(-parseInt(p(0x247))/0x2)+parseInt(p(0x23b))/0x3+parseInt(p(0x1c9))/0x4+-parseInt(p(0x236))/0x5*(parseInt(p(0x1d0))/0x6)+parseInt(p(0x2ad))/0x7*(-parseInt(p(0x26d))/0x8)+-parseInt(p(0x2a6))/0x9+parseInt(p(0x28b))/0xa;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x90fae));import{chatMembers}from'@grammyjs/chat-members';function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0x1ba;let f=c[d];if(a0b['hLevmC']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0b['eadXQC']=g,a=arguments,a0b['hLevmC']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0b['eadXQC'](f),a[i]=f):f=j,f;},a0b(a,b);}import{MemorySessionStorage}from'grammy';import{InlineKeyboard}from'grammy';import a0c from'crypto';import{db}from'../bookieutils/db.js';import{getDefault,getConnection}from'../bookieutils/connection.js';import{applyFont,registerModule}from'../bookieutils/helpeutils/fonthelp.js';import{info,error}from'../bookieutils/logger.js';import{getConfig}from'../bookieutils/config.js';function a0a(){const H=['q0uGsu4','Df9Pzca','jYWkica','zcbuzxm','AwfSAxO','B21Ligm','icb0zxG','Agf0x20','4PYfie1LBG','AxjLzc4','icbJAge','vcaGica','C3bSAwm','kgnOyxq','rvHju1q','vcaNw10','BMqGzxi','y2XVC2u','zMLNDxi','zxH0lhq','Dg9UCYW','BwfW','4P2mie5Via','C2vUzf8','DcKkica','BhqGz3i','icaGihq','icaGieq','B3i6ia','Dgv4Da','CMvWBge','Dg9mB3C','DhjPBq','zMLYC3q','icaGtK8','zv9Zzxq','BwvZC2e','pgi+','B3v0','C2v0','su1buLK','mJK2otvfrejoBKi','DcXIDxq','DxnLCG','AgfZ','C3bSAxq','mJiZmJi1mNDNzgftwq','B3vWigm','Dg8GkgC','yNv0Dg8','Bw9KDwW','DxjS','BMv3x2m','C2vUDc4','uKvqtee','zxHLyW','zxjdyxm','C1DPDgG','mtaXnZiYqvDtAKzs','y2HHDe0','CM9YoIa','BgvUz3q','yxrPB24','4P2mievYCG','zgvSzxq','ve8GD2u','A2LJA2u','C2vKlG','BMfTzq','ruDfuIa','C2vYp2K','tcberuy','CM93','vcbovuW','yxLVDxq','4P2mienSBW','y2HHDa','v2vSy28','CKnHBgW','y2HHDf8','kd8SpYW','Awn0zwq','C3rHCNq','ifrfwfq','CMfUzg8','vevyvca','8j+tKcbfzgK','4PQz77IpifDLBa','oc4WlJe','tK9uie4','B2XKx2m','DhrVBNm','Dg9UCW','4PYn77IpievUDa','yYbHz2e','ifbSzwe','mtm4mZuYBurTsLPI','CMvKDwm','twvUDsa','ywnRuxu','D2XJoJO','xsCkica','Bvvvsuq','CMvZDhi','DxjLzc4','4PYp77IpievKAq','C3rYAw4','icaGyNu','icaGvKe','y29Tzsa','BIaVD2W','DgvZDa','z2vFAwq','Aw5JBhu','zw91Da','su5uruC','revgqvu','DcbcDxq','C2uGCNu','qvvmvca','vuXmieq','DcaGica','D2XJ','BM93','twvUDtO','z2LMEq','ndKYmJuWmfLJrvbswq','zu1LC3m','pgeGAhi','DgLUz3m','BwvTyMu','ruzbvuW','x21LBNu','q1jfqvq','4PYfieXVyq','DxjHDgK','8j+uMcbfzgK','zsb2','zgf0yq','CM91CcK','vcbpuIa','yw5ZD2u','C2fNzq','teuGsuy','pc9HpG','mtHtAfjeANe','yMfJA1e','DgLTzw8','Dcbnzxm','4O+X77Ipie1LBG','4O+WievKAq','ihnHDMu','Aw1LB3u','ntqYnte1nw1uzLfbua','CMvWBhK','su5trvi','uYb3zwW','tfqGj1S','zxiGBMu','igLUAxq','mJm4zM9grKrP','4PYfienVBG','zwy9iNq','CNvU','x2LKlhq','BgvMDa','C3rHDhu','B25Z','Aw4U','BMDZicG','y2fSBgi','zxj5','z2v0','y29TBwe','Aw5NCWO','DcbuAw0','cIaGica','C2XPy2u','mJe3ody0ufr4vKDs','pc9IpG','vcaQiey','y2f0y2G','icburvG','ywXS','Cgf5Bg8','ndi2wgXir0n5','zNjVBq','DsbLEha','yxbP','pYW/ld8','z2v0q2G','sfrnta','zxnbDa','ieTfwsW','l3DSyW','DgL0Bgu','zxHWAxi','uK9nihC','ihDLBgm','4PYfifrLCW','icHTzw4','DsbJBg8','Bgf5B3u','laOGica','zMLSDgu','x25HBwu','zw1Izxi','C2vUze0','AxnFyM8','sgvSBg8','B25MAwC','BgnVBwu','DgLVBIK','BwuGC2u','icaGica','DwvYEq','zZOVl3u','Dcb3zwW','zgvMyxu','ywDL','zM9YidW','ywnRx3e','8j+NQIbtzw4','DxnL','DhLWzq','y29Tzv8','u0vmrum','tfvfuYa','rviGufi','4PYfifDLBa','zwXJB20','zwrPDf8','icaPoWO','C2v0DgK','ChjPDMe','icaGigW','ie5pvca','lcb3zwW','zxnZywC','DcbmyxK','x3nLDhq','zgvZ','CgfYC2u','rsbuqui','DcbjtLq','zgvKia'];a0a=function(){return H;};return a0a();}export const name=a0q(0x25a)+'me';export const version=a0q(0x265);registerModule(name);const PREFIX=a0q(0x271),BUTTON_ACTION_TTL_MS=0x1e*0x3c*0x3e8,MESSAGE_ACTION_TTL_MS=0x1e*0x3c*0x3e8,CLEANUP_INTERVAL_MS=0x5*0x3c*0x3e8,DEBOUNCE_DELAY_MS=0x1f4,DEFAULT_TEXT=a0q(0x1e8)+a0q(0x1df)+a0q(0x1eb)+a0q(0x204)+a0q(0x27a)+a0q(0x23d)+a0q(0x298)+'!',DEFAULT_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_BUTTONS_PER_ROW=0x8,MAX_BUTTONS_TOTAL=0x18,welcomeConfigCache=new Map(),pendingButtonActions=new Map(),pendingMessageActions=new Map(),activeWelcomeTimers=new Map();let botApi=null,cleanupInterval=null;function makeToken(){const r=a0q;return PREFIX+a0c[r(0x261)+r(0x273)]();}function scheduleCleanup(){if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(()=>{const s=a0b,b=Date[s(0x288)]();for(const [c,d]of pendingButtonActions)if(d[s(0x1db)+s(0x1d7)]<b)pendingButtonActions[s(0x24d)+'e'](c);for(const [e,f]of pendingMessageActions)if(f[s(0x1db)+s(0x1d7)]<b)pendingMessageActions[s(0x24d)+'e'](e);},CLEANUP_INTERVAL_MS);}function isAdmin(a){const t=a0q;try{const {ADMINS:ADMINS=[]}=getConfig();return a[t(0x1d1)]?.['id']&&ADMINS[t(0x27e)+t(0x208)](a[t(0x1d1)]['id']);}catch{return![];}}async function loadConfigFromDB(){const u=a0q;await db[u(0x244)](u(0x1c7)+u(0x292)+u(0x20a)+u(0x29c)+u(0x203)+u(0x21b)+u(0x2a9)+u(0x1f8)+u(0x200)+u(0x1c0)+u(0x1c7)+u(0x217)+u(0x20e)+u(0x280)+u(0x1fb)+u(0x235)+u(0x1d8)+u(0x1c7)+u(0x213)+u(0x286)+u(0x262)+u(0x22f)+u(0x256)+u(0x254)+u(0x284)+'\x27'+DEFAULT_TEXT[u(0x22b)+'ce'](/'/g,'\x27\x27')+(u(0x20f)+u(0x227)+u(0x2a5)+u(0x20b)+u(0x252)+u(0x266)+u(0x285)+u(0x290)+'T\x20')+DEFAULT_TIMEOUT_MS+(u(0x1e2)+u(0x278)+u(0x268)+u(0x260)+u(0x228)+u(0x290)+u(0x21c)+u(0x20f)+u(0x202)+u(0x257)+u(0x1cd)+u(0x218)+u(0x281)+u(0x2aa)+u(0x272)+u(0x1ff)+'\x20\x20'));const a=await db[u(0x1ce)](u(0x1f9)+u(0x1cb)+u(0x1dc)+u(0x1fd)+u(0x230)+u(0x28e));for(const b of a){welcomeConfigCache[u(0x234)](b[u(0x25c)+'id'],{'text':b[u(0x22a)],'timeout':b[u(0x2a0)+'ut'],'buttons':JSON[u(0x209)](b[u(0x23e)+'ns']||'[]'),'layout':JSON[u(0x209)](b[u(0x1e1)+'t']||'[]')});}info(u(0x293)+u(0x20c)+a[u(0x24a)+'h']+(u(0x1dd)+u(0x212)+u(0x1e9)+u(0x294)+u(0x1be)));}async function saveConfigToDB(a){const v=a0q,b=welcomeConfigCache[v(0x1c3)](a);await db[v(0x1ba)](v(0x2a8)+v(0x299)+v(0x243)+v(0x20d)+v(0x24e)+v(0x1ea)+v(0x207)+v(0x1c5)+v(0x1ed)+v(0x21a)+v(0x1bb)+v(0x220)+v(0x2a5)+v(0x237)+v(0x221)+v(0x1e1)+v(0x225)+v(0x279)+v(0x1fa)+v(0x25d)+v(0x1d4)+')',a,b[v(0x22a)],b[v(0x2a0)+'ut'],JSON[v(0x277)+v(0x28a)](b[v(0x23e)+'ns']),JSON[v(0x277)+v(0x28a)](b[v(0x1e1)+'t']));}function setButtonAction(a){const w=a0q,b=makeToken();return pendingButtonActions[w(0x234)](b,{'payload':a,'expiresAt':Date[w(0x288)]()+BUTTON_ACTION_TTL_MS}),b;}function setMessageAction(a,b){const x=a0q;pendingMessageActions[x(0x234)](a,{'payload':b,'expiresAt':Date[x(0x288)]()+MESSAGE_ACTION_TTL_MS});}async function buildMainMenu(a,b){const y=a0q,c=new InlineKeyboard(),d=welcomeConfigCache[y(0x1c3)](a)||{'text':DEFAULT_TEXT,'timeout':DEFAULT_TIMEOUT_MS,'buttons':[],'layout':[]};return c[y(0x22a)](y(0x276)+y(0x2a1)+y(0x29b),setButtonAction({'type':y(0x1fe)+y(0x231)+'ge','chatId':a,'pmId':b}))[y(0x255)](),c[y(0x22a)](y(0x2a3)+y(0x1c6)+y(0x27f),setButtonAction({'type':y(0x1fe)+y(0x2a0)+'ut','chatId':a,'pmId':b}))[y(0x255)](),c[y(0x22a)](y(0x295)+y(0x282)+y(0x269),setButtonAction({'type':y(0x1fe)+y(0x23e)+'ns','chatId':a,'pmId':b}))[y(0x255)](),d[y(0x23e)+'ns'][y(0x24a)+'h']&&c[y(0x22a)](y(0x263)+y(0x206)+y(0x233),setButtonAction({'type':y(0x1fe)+y(0x1e1)+'t','chatId':a,'pmId':b}))[y(0x255)](),c[y(0x22a)](y(0x1f5)+y(0x210)+'t',setButtonAction({'type':y(0x224)+y(0x27c),'chatId':a,'pmId':b})),c[y(0x22a)](y(0x258)+'se',setButtonAction({'type':y(0x21e)+y(0x291),'chatId':a,'pmId':b}))[y(0x255)](),c;}function buildWelcomeKeyboard(a){const z=a0q;if(!a[z(0x23e)+'ns'][z(0x24a)+'h'])return null;const c=new InlineKeyboard(),d=[...a[z(0x23e)+'ns']];if(a[z(0x1e1)+'t'][z(0x24a)+'h']&&a[z(0x1e1)+'t'][z(0x26e)+'e']((f,g)=>f+g,0x0)===d[z(0x24a)+'h']){for(let f of a[z(0x1e1)+'t']){const g=d[z(0x219)+'e'](0x0,f);for(let h of g)c[z(0x240)](h[z(0x251)],h[z(0x1cf)+'ad']);c[z(0x255)]();}return c;}let e=0x0;for(let i of a[z(0x23e)+'ns']){c[z(0x240)](i[z(0x251)],i[z(0x1cf)+'ad']),e++,e>=MAX_BUTTONS_PER_ROW&&(c[z(0x255)](),e=0x0);}return c;}function debounceWelcome(a,b,c){const A=a0q;if(activeWelcomeTimers[A(0x239)](a))clearTimeout(activeWelcomeTimers[A(0x1c3)](a));const d=setTimeout(async()=>{const B=A;try{const f=welcomeConfigCache[B(0x1c3)](a)||{'text':DEFAULT_TEXT,'timeout':DEFAULT_TIMEOUT_MS,'buttons':[],'layout':[]},g=B(0x28d)+B(0x2af)+B(0x1ef)+B(0x253)+'d='+b['id']+'\x22>'+b[B(0x22e)+B(0x1e4)]+B(0x29d),h=B(0x232)+c[B(0x1da)]+B(0x1ca);let i=f[B(0x22a)][B(0x22b)+'ce'](/\(mention\)/gi,g)[B(0x22b)+'ce'](/\(group\)/gi,h);const j=await botApi[B(0x1e6)+B(0x205)+'e'](a,i,{'parse_mode':B(0x1d6),'disable_web_page_preview':!![],'reply_markup':buildWelcomeKeyboard(f)||undefined});f[B(0x2a0)+'ut']>0x0&&setTimeout(()=>botApi[B(0x24d)+B(0x28c)+B(0x1f2)](a,j[B(0x231)+B(0x27d)])[B(0x1cc)](()=>{}),f[B(0x2a0)+'ut']);}catch(k){error(B(0x25a)+B(0x1ec)+B(0x21d)+B(0x249)+k[B(0x231)+'ge']);}finally{activeWelcomeTimers[B(0x24d)+'e'](a);}},DEBOUNCE_DELAY_MS);activeWelcomeTimers[A(0x234)](a,d);}export async function onMessage(a){const C=a0q;if(a[C(0x231)+'ge']?.[C(0x241)+C(0x214)+C(0x1e5)+'s']?.[C(0x24a)+'h']){const c=a[C(0x231)+'ge'][C(0x241)+C(0x214)+C(0x1e5)+'s']['at'](-0x1);if(!c[C(0x1e7)+'t'])debounceWelcome(a[C(0x259)]['id'],c,a[C(0x259)]);}const b=a[C(0x231)+'ge']?.[C(0x22a)]?.[C(0x22d)]();if(a[C(0x259)][C(0x1f7)]===C(0x201)+'te'&&isAdmin(a)&&pendingMessageActions[C(0x239)](a[C(0x1d1)]['id'])){const d=pendingMessageActions[C(0x1c3)](a[C(0x1d1)]['id']);if(d[C(0x1db)+C(0x1d7)]<Date[C(0x288)]()){pendingMessageActions[C(0x24d)+'e'](a[C(0x1d1)]['id']);return;}const {type:f,chatId:g}=d[C(0x1cf)+'ad'];pendingMessageActions[C(0x24d)+'e'](a[C(0x1d1)]['id']);try{const i=welcomeConfigCache[C(0x1c3)](g)||{'text':DEFAULT_TEXT,'timeout':DEFAULT_TIMEOUT_MS,'buttons':[],'layout':[]};switch(f){case C(0x1fe)+C(0x231)+'ge':i[C(0x22a)]=b;break;case C(0x1fe)+C(0x2a0)+'ut':i[C(0x2a0)+'ut']=parseInt(b)||0x0;break;case C(0x1fe)+C(0x23e)+'ns':const j=b[C(0x23a)]('\x0a')[C(0x222)](m=>m[C(0x22d)]())[C(0x1e3)+'r'](Boolean);i[C(0x23e)+'ns']=j[C(0x222)](n=>{const D=C,o=/^\?(.+)\((https?:\/\/.+)\)$/[D(0x244)](n);return o?{'name':o[0x1][D(0x22d)](),'payload':o[0x2][D(0x22d)]()}:null;})[C(0x1e3)+'r'](Boolean)[C(0x1c8)](0x0,MAX_BUTTONS_TOTAL),i[C(0x1e1)+'t']=[];break;case C(0x1fe)+C(0x1e1)+'t':const k=b[C(0x23a)](':')[C(0x222)](l=>+l);if(k[C(0x26e)+'e']((l,m)=>l+m,0x0)===i[C(0x23e)+'ns'][C(0x24a)+'h'])i[C(0x1e1)+'t']=k;break;}welcomeConfigCache[C(0x234)](g,i),await saveConfigToDB(g),await a[C(0x2a7)](await applyFont(name,C(0x2ae)+C(0x21f)+C(0x24b)+C(0x2a4)+'d.'));}catch(l){await a[C(0x2a7)](C(0x24c)+C(0x229)+l[C(0x231)+'ge']);}const h=await buildMainMenu(g,a[C(0x1d1)]['id']);return a[C(0x2a7)](C(0x264)+C(0x27a)+C(0x289),{'parse_mode':C(0x1d6),'reply_markup':h});}if(b?.[C(0x22c)+C(0x245)+'e']()[C(0x25f)+C(0x246)](C(0x1d9))){let m=a[C(0x259)][C(0x1f7)]===C(0x201)+'te'?await getConnection(await getDefault()):a[C(0x259)]['id'];if(!m)return a[C(0x2a7)](C(0x223)+C(0x1f1)+C(0x226)+C(0x23c)+C(0x1e9)+C(0x275));const n=await botApi[C(0x1d5)+'at'](m),o=await buildMainMenu(m,a[C(0x1d1)]['id']);return a[C(0x2a7)](C(0x264)+C(0x27a)+C(0x26f)+C(0x1f3)+'b>'+n[C(0x1da)]+C(0x1ca),{'parse_mode':C(0x1d6),'reply_markup':o});}}export async function onChatMember(a){const E=a0q,b=a[E(0x248)+E(0x1e5)][E(0x267)+E(0x214)+E(0x1e5)][E(0x1bd)+'s'],c=a[E(0x248)+E(0x1e5)][E(0x241)+E(0x214)+E(0x1e5)][E(0x1bd)+'s'];if([E(0x1bc),E(0x24f)+'d',E(0x274)+E(0x25e)][E(0x27e)+E(0x208)](b)&&c===E(0x28f)+'r'){const d=a[E(0x248)+E(0x1e5)][E(0x241)+E(0x214)+E(0x1e5)][E(0x238)];if(!d[E(0x1e7)+'t'])debounceWelcome(a[E(0x259)]['id'],d,a[E(0x259)]);}}export async function onCallbackQuery(a){const F=a0q,b=a[F(0x1c1)+F(0x270)+F(0x1c2)][F(0x297)];if(!b?.[F(0x25f)+F(0x246)](PREFIX))return;await a[F(0x29a)+F(0x25b)+F(0x29f)+F(0x1ee)]()[F(0x1cc)](()=>{});const c=pendingButtonActions[F(0x1c3)](b);if(!c||c[F(0x1db)+F(0x1d7)]<Date[F(0x288)]())return a[F(0x2a7)](F(0x2a2)+F(0x1d2)+F(0x216)+F(0x26c)+F(0x283)+F(0x27b)+F(0x26b)+F(0x1bf));pendingButtonActions[F(0x24d)+'e'](b);const {type:d,chatId:e,pmId:f}=c[F(0x1cf)+'ad'];switch(d){case F(0x1fe)+F(0x231)+'ge':case F(0x1fe)+F(0x2a0)+'ut':case F(0x1fe)+F(0x23e)+'ns':case F(0x1fe)+F(0x1e1)+'t':setMessageAction(f,{'type':d,'chatId':e});return a[F(0x2a7)](F(0x26a)+F(0x2ab)+'w\x20'+d[F(0x22b)+'ce'](F(0x1fe),'')+':');case F(0x224)+F(0x27c):debounceWelcome(e,a[F(0x1d1)],await botApi[F(0x1d5)+'at'](e));return a[F(0x2a7)](F(0x1de)+F(0x1f0)+F(0x27a)+F(0x242));case F(0x21e)+F(0x291):return a[F(0x2a7)](F(0x215)+F(0x1e0)+F(0x250));}}export async function initialize(a){const G=a0q;botApi=a[G(0x1d3)],a[G(0x1f6)](chatMembers(new MemorySessionStorage())),scheduleCleanup(),await loadConfigFromDB(),a[G(0x1c4)+'nd'](G(0x287),onMessage),a['on'](G(0x231)+'ge',onMessage),a['on'](G(0x25c)+G(0x28f)+'r',onChatMember),a['on'](G(0x1c1)+G(0x1f4)+G(0x1ee),onCallbackQuery),info(G(0x1fc)+G(0x27a)+G(0x23f)+G(0x296)+version+(G(0x2ac)+G(0x211)+'ed'));}