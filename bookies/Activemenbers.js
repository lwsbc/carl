const a0B=a0b;(function(a,b){const A=a0b,c=a();while(!![]){try{const d=-parseInt(A(0xce))/0x1+-parseInt(A(0x197))/0x2+-parseInt(A(0x155))/0x3+parseInt(A(0x105))/0x4+parseInt(A(0xa9))/0x5*(parseInt(A(0xa4))/0x6)+parseInt(A(0x165))/0x7+parseInt(A(0x17b))/0x8;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0xa469b));import{InlineKeyboard}from'grammy';function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0x9f;let f=c[d];if(a0b['pobIWH']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0b['kzkRaV']=g,a=arguments,a0b['pobIWH']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0b['kzkRaV'](f),a[i]=f):f=j,f;},a0b(a,b);}import{DateTime}from'luxon';import{db}from'../bookieutils/db.js';import{getDefault,getConnection}from'../bookieutils/connection.js';import{applyFont,registerModule}from'../bookieutils/helpeutils/fonthelp.js';import{info,error}from'../bookieutils/logger.js';import{getConfig}from'../bookieutils/config.js';export const name=a0B(0x171)+a0B(0x117)+a0B(0x118);export const version=a0B(0x19d);registerModule(name);const CALLBACK_PREFIX=a0B(0x1c7)+a0B(0x19e),TIME_ZONE=a0B(0x16a)+a0B(0x188)+a0B(0x201),MAX_MESSAGES_TO_STORE=0x32,SAVE_DEBOUNCE_MS=0x3a98,USERS_PER_PAGE=0xa,TIMEFRAMES={'DAILY':a0B(0x203),'WEEKLY':a0B(0x187)+'y','MONTHLY':a0B(0x1f9)+'ly','YEARLY':a0B(0x142)+'y','LAST_WEEKLY':a0B(0x101)+a0B(0x1e7)};let activity=new Map(),botApi=null,saveTimer=null;const escapeHtml=a=>typeof a===a0B(0x112)+'g'?a[a0B(0x146)+'ce'](/&/g,a0B(0x1d3))[a0B(0x146)+'ce'](/</g,a0B(0xc4))[a0B(0x146)+'ce'](/>/g,a0B(0x1b2))[a0B(0x146)+'ce'](/"/g,a0B(0x1fd)+';')[a0B(0x146)+'ce'](/'/g,a0B(0x1cb)+';'):a,isAdmin=a=>{const C=a0B;try{const {ADMINS:ADMINS=[]}=getConfig();return a[C(0x16f)]?.['id']&&Array[C(0x145)+'ay'](ADMINS)&&ADMINS[C(0x19f)+C(0x17f)](a[C(0x16f)]['id']);}catch{return![];}};function getChatActivity(a){const D=a0B;return!activity[D(0xd5)](a)&&activity[D(0x17e)](a,{[TIMEFRAMES[D(0x116)]]:new Map(),[TIMEFRAMES[D(0xfc)+'Y']]:new Map(),[TIMEFRAMES[D(0x128)+'LY']]:new Map(),[TIMEFRAMES[D(0x1e9)+'Y']]:new Map(),[TIMEFRAMES[D(0x191)+D(0xfc)+'Y']]:new Map()}),activity[D(0xdf)](a);}async function initDatabase(){const E=a0B;await db[E(0x1f1)](E(0x1d7)+E(0x1ba)+E(0x1e4)+E(0x1b9)+E(0xa7)+E(0xe8)+E(0x119)+E(0x141)+E(0x159)+E(0x1e8)+E(0x168)+E(0x1a1)+E(0x1d1)+E(0x1a4)+E(0xcc)+E(0x180)+E(0x161)+E(0x168)+E(0x133)+E(0xe0)+E(0xb7)+E(0xf2)+E(0xa1)+E(0x1b1));}function rehydrateChatData(a){const F=a0B,b={};for(const c of Object[F(0x17a)+'s'](TIMEFRAMES)){const d=a[c]||[];b[c]=new Map(d[F(0x131)](([e,f])=>[Number(e),{...f,'m':new Set(f['m']||[])}]));}return b;}async function loadActivityFromDB(){const G=a0B,a=await db[G(0x205)](G(0x1ca)+G(0x1dd)+G(0x18e)+G(0x19b)+G(0x13f)+G(0x10b)+G(0xdc)+G(0x18b));activity[G(0x1c2)]();for(const {chat_id:b,data:c}of a){try{activity[G(0x17e)](b,rehydrateChatData(JSON[G(0x1b3)](c)));}catch(d){await db[G(0xbf)](G(0xa2)+G(0xd8)+G(0x1a0)+G(0x141)+G(0x159)+G(0x1ae)+G(0x12d)+G(0x136)+G(0xe6),b),info(G(0x13d)+G(0xb8)+G(0x154)+G(0x170)+G(0x15b)+G(0xb2)+'t\x20'+b);}}}function dehydrate(a){const H=a0B,b={};for(const c of Object[H(0x17a)+'s'](TIMEFRAMES)){b[c]=Array[H(0x16f)](a[c][H(0xf8)+'es']())[H(0x131)](([d,e])=>[d,{...e,'m':Array[H(0x16f)](e['m'])}]);}return b;}function markChanged(){clearTimeout(saveTimer),saveTimer=setTimeout(saveAllActivityToDB,SAVE_DEBOUNCE_MS);}async function saveAllActivityToDB(){const I=a0B;for(const [a,b]of activity[I(0xf8)+'es']()){const c=JSON[I(0x112)+I(0xf7)](dehydrate(b));await db[I(0xbf)](I(0xc6)+I(0xfe)+I(0xb4)+I(0x12e)+I(0x1cf)+I(0x107)+I(0x1c1)+I(0x193)+I(0x135)+I(0x1e1)+I(0x1a8)+I(0xbd)+I(0x104)+'?)',a,c);}info(I(0x144)+I(0x10b)+I(0x15e)+I(0xcd)+activity[I(0xbb)]+(I(0x163)+'s'));}function trackMessage(a){const J=a0B,{from:b,chat:c,message:d}=a;if(!b||b[J(0x1f6)+'t']||isAdmin(a))return;const e=d?.[J(0xc9)];if(!e)return;const f=getChatActivity(c['id']);for(const g of[TIMEFRAMES[J(0x116)],TIMEFRAMES[J(0xfc)+'Y'],TIMEFRAMES[J(0x128)+'LY'],TIMEFRAMES[J(0x1e9)+'Y']]){const h=f[g],i=h[J(0xdf)](b['id'])||{'c':0x0,'f':b[J(0x1f7)+J(0x13b)],'u':b[J(0x1ff)+J(0xde)],'m':new Set()};i['c']++,i['f']=b[J(0x1f7)+J(0x13b)],i['u']=b[J(0x1ff)+J(0xde)],i['m'][J(0xaa)](e);if(i['m'][J(0xbb)]>MAX_MESSAGES_TO_STORE){const j=Array[J(0x16f)](i['m']);j[J(0x120)](),i['m']=new Set(j);}h[J(0x17e)](b['id'],i);}markChanged();}function a0a(){const X=['igzVDw4','yxbP','icaGktS','revmrvq','l2fJDgK','mZa2nMHjt0DYwq','yw5ZD2u','zxqGqwW','ie5pvca','BwvUDq','mtaYmZvnDujNzfm','ywrK','8j+uMsbcywm','DxaGjW','AgfTCgK','BgLZDa','BgWGzgu','CMX5','x3bYB20','CIbJAge','8j+uPsbmAxy','uKvqtee','pgK+vxa','DgL0Bgu','tK9uie4','zwqGy28','igzVCIa','idXHigG','C2L6zq','CM9Yig8','quXvrvm','AYb0BYa','CNvU','4QYf77IpifbYzq','BwLU','yxrHlG','4P2mienHBG','jMX0oW','tgLZDa','su5trvi','C2vJB24','C3rHCNq','Dgv4Da','z2vZihi','ihjLC3u','ifbssu0','zM9Yia','ntmZndq5uNzOv0Dr','ysbYzxm','BgfZDge','C2fNzxm','zxj5','CMu/pc8','yMfJA1e','AgfZ','ihrOzsa','ihyZlJm','rsbguK8','ywnRigu','igXHC3q','Bcbeyxq','DML0Ev8','BgL2zsa','yw1L','z2v0','vevyvca','zwfSlxq','Aw4GDgG','zt4kcG','zwDLBMq','BxnNCZO','id0GpW','y2n1CNi','rvHju1q','BgvHzgu','zwnVCMq','DgvZDca','DhLWzq','DxnLCJ8','CYbJB24','zsbMB3i','y2vS','AxmGD2K','vuXmcIa','p2LKpq','zgLMzG','yxmGyMu','B3jKzwq','z2LMEq','zw50CMK','4OcuidXIpG','CYdWN5sL','D2vLAYC','v0vfs0W','AxjToJO','vcbpuIa','pc9HpIa','y3rPDMu','BgfZDfC','ywn0Axy','z2uG','icG/lca','mZC2mZC0nfHTC2DXCW','CMjVyxi','DgL2Axq','4PIa77IpierHAq','8j+AQYboB3q','zxjdyxm','igfJDgK','C3qGyMu','AxzLifu','l2XHC3q','B3vZihC','8j+NUsbszxm','C2v0wM8','C3rYAw4','Awq9','ktWVAt4','ipcFJ4pWN5kO','refjtfK','zu1LBwi','zxjZ','uYbHy3q','CMvZzxq','CNjVCIa','zw5Kt2y','u0Lhveu','pc9IpIa','zwvRj3m','C2HPzNq','pgK+ka','C1DPDgG','ihDLzwS','zxqH','igLUihi','8j+tNcboBYa','lIa8y28','tu9oveG','z2uGAxm','C2XPy2u','Dcbxzwu','CKnHBgW','uKuGy2G','q0uGsu4','vxnLCIa','pc9JB2q','BwfW','8j+xK++4JYbnB24','zgf0ysa','ywnRuxu','Agf0x2K','yxrFAwq','zsbxzwu','BhrZlJW','8j+tHsbxzwu','zwn0ige','x25HBwu','igf1DgG','rgvSzxq','pgi+','iezst00','A2X5','AxzPDhK','EwvHCMW','BwvUDtO','u2f2zwq','AxnbCNi','CMvWBge','zgf0zwq','DgC6lY8','AxPLzc4','y2vPBa','EsbYzwm','C3bSAxq','Axb0Aw8','zgf5','8j+oHIbzzwe','BxnNCW','C3vWzxi','8j+pHIbmyxm','z3vUisa','CNj1Chq','mtG1otyZmwPqCg1cBW','CMLVzc4','DwvYEq','AwvK','x3n0yxq','8j+tNcbnzxm','DgeGzM8','z3jVDxa','A2X5ieW','DML0Esa','sfrnta','lIa8ysa','rvKScIa','4PYfierHDa','ignOyxq','vxnLic8','mZmZmtG2AwnZv2z6','z2v0q2G','zvrLEhq','icaGica','zgu+','qwzYAwm','ChvZAa','zwqU','jYbUB3q','qxjLihK','zNjVBq','zwqGzge','qwn0Axy','BgvUz3q','AxzLtwu','Bw9KAwy','l3vZzxi','AxmGCgu','Aw1LlIa','8j+rPsbby3q','DhjPBq','DMfSDwu','nZaWmta1nNjnAM5xCG','AM9PBG','tM8Gywm','C2v0','zgvZ','qvjzieS','iNrNoI8','y2HHDa','B3vWihm','y2fSBgi','twvUDq','yJ4kvgG','D2vLA2W','ys9oywK','B3jPEMu','CgX1CW','C3rHDgu','zwrPDe0','y2HHCKe','Df9PzcW','igzYB20','vgHPCYa','teftvf8','C2vYCYa','DguGkgm','BMCUlI4','pc9IpJO','B3uGC3u','mJe2ntG0nfDVCw5PDa','ChjLDMK','x2nVBMy','BwLSBgK','igrHDge','Dg9mB3C','mY4ZlJi','BtO6','Aw5JBhu','tsbHy3q','y2HHDf8','l2K+','D2vLA2q','vevhrvi','pc9HpGO','Bwf4','cGO8At4','DgePify','BgLZDdO','4PYfifLLCW','xtOG','zgf0yq','zgvZy3i','zsbxseu','CIa8ysa','zc48l2K','cIaG','jMD0oW','CgfYC2u','Chq6oG','BwjLCNm','AYDZiem','DgHPCYa','CMvWBhK','teuGsuy','q1jfqvq','CgvYAw8','zgvSzxq','zwqGzM8','pgK+qsa','lJiGAw4','WQSGqMfJ','Ev9ZDge','y2XLyxi','Bgv0zsa','8j+tIIbtzwW','z2LUBMK','4P2mie5Via','ywn0Bwu','j3mGBM8','CMvMpsi','u0vmrum','jImWmZK','AhjLzJ0','zxqU','ywXSigq','ve8Gywm','vgLTzwy','AwqGsu4','ig5VDca','jMfTCdS','AxmGANu','zxHPDa','AxjT','cIaGica','ChjPDMe','vgHLCMu','CM93','zNjHBwu','DMLVDxm','vcbJAge','vxnLCG','tMv4Dca','u0Lhsu4','zcWGzge','q2fSBgi','pgi+4PQG77Ipia','rsbuqui','Dg9vCha','BwvZC2e','zwvRBhK','zsaOcIa','wuvbuKW','4P2mieDYBW','zwvRigG','ihWGuge','C29YDa','4PYfiefJDa','zxnZywC','B25ZipcFJ4y','zxHLyW','zM9Yrwe','z2vZ','BMv3ihC','DgHSEq','AxnFyM8','zMLYC3q','BhqGz3i','Bw9UDgG','AxrPywW','lcbYzxm','CMfTzxm','jNf1B3q','BM93','DxnLCM4','qw4Gzxi','CM9IAq','zgvMyxu','zgfPBhK','ihrPBwu','ywXS','cGPqywC'];a0a=function(){return X;};return a0a();}async function getPublicLeaderboard(a,b){const K=a0B,c=getChatActivity(a)[b],d=Array[K(0x16f)](c[K(0xf8)+'es']())[K(0x1ed)](([,k],[,l])=>l['c']-k['c'])[K(0x12a)](0x0,0x19),e=b===TIMEFRAMES[K(0xfc)+'Y'],f=e?K(0xb3)+K(0x137)+K(0x15d)+K(0xe4)+K(0xfa):K(0x152)+K(0x12b)+K(0x1b6)+K(0xad)+K(0x1f0),g=await applyFont(name,f),h=e?K(0xb5)+K(0x147)+K(0x125)+K(0xe1)+K(0x177)+K(0x164)+K(0xd0)+K(0x100)+K(0xb9)+K(0x198)+K(0x10f)+K(0x11f)+K(0xcb)+K(0x138)+K(0x1a2):K(0x1be)+K(0x1f4)+K(0x1eb)+K(0xf5)+K(0x153)+K(0x164)+K(0x102)+K(0xef)+K(0xd6)+K(0xdd)+K(0xe9)+K(0x106)+K(0x1b0)+'>';if(!d[K(0x172)+'h'])return g+'\x0a\x0a'+(e?K(0x190)+K(0xfb)+K(0xee)+K(0xeb)+K(0x1d4)+K(0x10c)+K(0x1c5)+K(0x194)+K(0x115):K(0x1d9)+K(0x1c8)+K(0x19b)+K(0x18f)+K(0xda)+K(0x123)+'.')+'\x0a\x0a'+h;const i=e?['ðŸ†','ðŸ¥ˆ','ðŸ¥‰']:['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰'],j=d[K(0x131)](([k,l],m)=>{const L=K,n=l['u']?'@'+l['u']:escapeHtml(l['f']),o=m<0x3?'\x20'+i[m]:'';return m+0x1+(L(0x160)+L(0x1cc)+L(0x181)+L(0x175)+L(0xf3))+k+'\x22>'+n+(L(0xff)+L(0xf9))+l['c']+(L(0x11e)+L(0x1e6)+L(0x1f3))+o;});return g+'\x0a\x0a'+j[K(0x17c)]('\x0a')+'\x0a\x0a'+h;}async function generateTimeframeMenu(a){const M=a0B,b=await botApi[M(0x166)+'at'](a),c=await applyFont(name,M(0x1c4)+M(0x13a)+M(0x204)+M(0x1db)+M(0xb9)+M(0x13e)+escapeHtml(b[M(0xb6)])+M(0x195)),d=new InlineKeyboard()[M(0xc9)](M(0x108)+'ly',CALLBACK_PREFIX+(M(0x1a9)+':')+a+'::'+TIMEFRAMES[M(0x116)])[M(0xc9)](M(0x139)+M(0x140),CALLBACK_PREFIX+(M(0x1a9)+':')+a+'::'+TIMEFRAMES[M(0xfc)+'Y'])[M(0x1da)]()[M(0xc9)](M(0x132)+M(0x1f5),CALLBACK_PREFIX+(M(0x1a9)+':')+a+'::'+TIMEFRAMES[M(0x128)+'LY'])[M(0xc9)](M(0x14f)+M(0xb0),CALLBACK_PREFIX+(M(0x1a9)+':')+a+'::'+TIMEFRAMES[M(0x1e9)+'Y'])[M(0x1da)]()[M(0xc9)](M(0x110)+M(0xa6)+M(0xdb)+'a',CALLBACK_PREFIX+(M(0x11a)+M(0xb1)+M(0x1b4))+a);return{'text':c,'keyboard':d};}async function generateUserListMenu(a,b,c=0x1){const N=a0B,d=getChatActivity(a)[b];let e=await applyFont(name,N(0x178)+N(0x10d)+N(0x192)+'('+(b[N(0x18d)+'t'](0x0)[N(0x1e5)+N(0x10a)+'e']()+b[N(0x12a)](0x1))+')');if(!d[N(0xbb)]){const k=new InlineKeyboard()[N(0xc9)](N(0xab)+'k',CALLBACK_PREFIX+(N(0x143)+':')+a);return{'text':e+(N(0x1a7)+N(0x17d)+N(0x107)+N(0x14b)+N(0xf6)+N(0xb9)+N(0x1b7)+N(0x1bb)+N(0x1b0)+'>'),'keyboard':k};}const f=Array[N(0x16f)](d[N(0xf8)+'es']())[N(0x1ed)](([,l],[,m])=>m['c']-l['c']),g=Math[N(0x14a)](f[N(0x172)+'h']/USERS_PER_PAGE);c=Math[N(0x1a6)](0x1,Math[N(0xc1)](c,g));const h=f[N(0x12a)]((c-0x1)*USERS_PER_PAGE,c*USERS_PER_PAGE),i=new InlineKeyboard();h[N(0x1f2)+'ch'](([l,m])=>{const O=N,n=m['u']?'@'+m['u']:escapeHtml(m['f']);i[O(0xc9)](n+'\x20('+m['c']+')',CALLBACK_PREFIX+(O(0xe5)+':')+a+'::'+b+'::'+l+'::'+c)[O(0x1da)]();});const j=[];if(c>0x1)j[N(0x16b)]({'text':N(0xc0)+'v','callback_data':CALLBACK_PREFIX+(N(0x1a9)+':')+a+'::'+b+'::'+(c-0x1)});if(c<g)j[N(0x16b)]({'text':N(0x1df)+'âž¡ï¸','callback_data':CALLBACK_PREFIX+(N(0x1a9)+':')+a+'::'+b+'::'+(c+0x1)});if(j[N(0x172)+'h'])i[N(0x1da)](...j);return i[N(0xc9)](N(0xab)+N(0xbe)+N(0x1d0)+N(0x1fc),CALLBACK_PREFIX+(N(0x143)+':')+a),e+=N(0x206)+'e\x20'+c+'/'+g,{'text':e,'keyboard':i};}async function generateUserMessagesView(a,b,c,d=0x1,e=0x1){const P=a0B,f=getChatActivity(a)[b][P(0xdf)](c),g=f?.['u']?'@'+f['u']:escapeHtml(f?.['f']||P(0x1de));if(!f||!f['m'][P(0xbb)]){const q=await applyFont(name,P(0x126)+P(0x1e6)+P(0xca)+P(0xea)+P(0x1bd)+P(0x1af)+P(0x1cc)+P(0x181)+P(0x175)+P(0xf3)+c+'\x22>'+g+(P(0xff)+P(0xe2)+P(0x176)+P(0x156))),r=new InlineKeyboard()[P(0xc9)](P(0xab)+P(0xbe)+P(0x12f)+P(0xc5),CALLBACK_PREFIX+(P(0x1a9)+':')+a+'::'+b+'::'+e);return{'text':q,'keyboard':r};}const h=Array[P(0x16f)](f['m']),i=[];let j='';const k=P(0x15a)+P(0xd1)+P(0x18f)+P(0xba)+P(0x1c9)+P(0x148)+P(0xed)+P(0x113)+c+'\x22>'+g+P(0x1a5)+(P(0x121)+(b[P(0x18d)+'t'](0x0)[P(0x1e5)+P(0x10a)+'e']()+b[P(0x12a)](0x1))+(P(0x114)+'\x0a\x0a'));h[P(0x1f2)+'ch']((s,t)=>{const Q=P,u=t+0x1+(Q(0x127)+Q(0x169))+escapeHtml(s)+(Q(0x130)+Q(0xe3));j[Q(0x172)+'h']+u[Q(0x172)+'h']+k[Q(0x172)+'h']>0xed8&&j&&(i[Q(0x16b)](j),j=''),j+=u;});if(j)i[P(0x16b)](j);const l=i[P(0x172)+'h'];d=Math[P(0x1a6)](0x1,Math[P(0xc1)](d,l));const m=await applyFont(name,k[P(0x146)+'ce'](')',P(0x1ec)+P(0x103)+d+'/'+l+')')),n=m+i[d-0x1],o=new InlineKeyboard(),p=[];if(d>0x1)p[P(0x16b)]({'text':P(0xc0)+P(0x1dc),'callback_data':CALLBACK_PREFIX+(P(0xe5)+':')+a+'::'+b+'::'+c+'::'+(d-0x1)+'::'+e});if(d<l)p[P(0x16b)]({'text':P(0x1df)+'âž¡ï¸','callback_data':CALLBACK_PREFIX+(P(0xe5)+':')+a+'::'+b+'::'+c+'::'+(d+0x1)+'::'+e});if(p[P(0x172)+'h'])o[P(0x1da)](...p);return o[P(0xc9)](P(0xab)+P(0xbe)+P(0x12f)+P(0xc5),CALLBACK_PREFIX+(P(0x1a9)+':')+a+'::'+b+'::'+e),{'text':n,'keyboard':o};}export async function onMessage(a){const R=a0B;if(!botApi)botApi=a[R(0xa0)];const b=[R(0x15c),R(0x151)+R(0x15c)][R(0x19f)+R(0x17f)](a[R(0x182)][R(0xec)]),c=a[R(0x1e6)+'ge']?.[R(0xc9)]?.[R(0x179)]()?.[R(0x19c)+R(0x10a)+'e']();if(b){trackMessage(a);if(c===R(0xa3)+'ve'){const d=await getPublicLeaderboard(a[R(0x182)]['id'],TIMEFRAMES[R(0xfc)+'Y']);return a[R(0x1b8)](d,{'parse_mode':R(0x15f),'disable_web_page_preview':!![]});}if(c===R(0x10e)+R(0x102)+'e'){const e=await getPublicLeaderboard(a[R(0x182)]['id'],TIMEFRAMES[R(0x191)+R(0xfc)+'Y']);return a[R(0x1b8)](e,{'parse_mode':R(0x15f),'disable_web_page_preview':!![]});}}if(a[R(0x182)][R(0xec)]===R(0x1d8)+'te'&&isAdmin(a)&&c===R(0xa3)+'ve'){const f=await getDefault();if(!f)return a[R(0x1b8)](await applyFont(name,R(0x1c6)+R(0x202)+R(0x1f8)+R(0x183)+R(0x1cd)));const g=await getConnection(f);if(!g)return a[R(0x1b8)](await applyFont(name,R(0x1ea)+R(0xac)+f+(R(0x16d)+R(0x9f)+'d.')));const {text:h,keyboard:i}=await generateTimeframeMenu(g);await a[R(0x1b8)](h,{'parse_mode':R(0x15f),'reply_markup':i});}}export async function onCallbackQuery(a){const S=a0B,b=a[S(0x184)+S(0x134)+S(0xd2)]?.[S(0x1ac)];if(!b?.[S(0xc8)+S(0x122)](CALLBACK_PREFIX))return;if(!isAdmin(a))return a[S(0xa5)+S(0x12c)+S(0xd4)+S(0x157)]({'text':S(0x109)+S(0x13c)+S(0x189)+'d','show_alert':!![]});await a[S(0xa5)+S(0x12c)+S(0xd4)+S(0x157)]();if(!botApi)botApi=a[S(0xa0)];const c=b[S(0x14c)]('::'),f=c[0x1];try{switch(f){case S(0xa8):{const g=Number(c[0x2]),{text:h,keyboard:i}=await generateTimeframeMenu(g);await a[S(0x18c)+S(0x1ef)+S(0x167)](h,{'parse_mode':S(0x15f),'reply_markup':i});break;}case S(0xae):{const j=Number(c[0x2]),k=c[0x3],l=Number(c[0x4])||0x1,{text:m,keyboard:n}=await generateUserListMenu(j,k,l);await a[S(0x18c)+S(0x1ef)+S(0x167)](m,{'parse_mode':S(0x15f),'reply_markup':n});break;}case S(0x150):{const o=Number(c[0x2]),p=c[0x3],q=Number(c[0x4]);let r=0x1,s=0x1;if(c[S(0x172)+'h']===0x6)s=Number(c[0x5]);else c[S(0x172)+'h']>=0x7&&(r=Number(c[0x5]),s=Number(c[0x6]));const {text:t,keyboard:u}=await generateUserMessagesView(o,p,q,r,s);await a[S(0x18c)+S(0x1ef)+S(0x167)](t,{'parse_mode':S(0x15f),'reply_markup':u,'disable_web_page_preview':!![]});break;}case S(0x11a)+S(0xb1)+'pt':{const v=Number(c[0x2]),w=new InlineKeyboard()[S(0xc9)](S(0x1aa)+S(0x1fb)+S(0x124),CALLBACK_PREFIX+(S(0x11a)+S(0x199)+S(0xfd))+v)[S(0xc9)](S(0xc3)+S(0xf0),CALLBACK_PREFIX+(S(0x143)+':')+v);await a[S(0x18c)+S(0x1ef)+S(0x167)](await applyFont(name,S(0x1e3)+S(0x16e)+S(0x196)+S(0xd3)+S(0x186)+S(0xf1)+S(0xaf)+S(0x1c3)+S(0x1ce)+S(0xc2)),{'parse_mode':S(0x15f),'reply_markup':w});break;}case S(0x11a)+S(0x199)+S(0x1d6):{const x=Number(c[0x2]);activity[S(0x1bc)+'e'](x),await db[S(0xbf)](S(0xa2)+S(0xd8)+S(0x1a0)+S(0x141)+S(0x159)+S(0x1ae)+S(0x12d)+S(0x136)+S(0xe6),x),markChanged();const y=new InlineKeyboard()[S(0xc9)](S(0x1c0)+S(0xbe)+S(0x185),CALLBACK_PREFIX+(S(0x143)+':')+x);await a[S(0x18c)+S(0x1ef)+S(0x167)](await applyFont(name,S(0x162)+S(0xcf)+S(0x1cd)),{'reply_markup':y});break;}}}catch(z){!z[S(0x1ad)+S(0x14d)+'n']?.[S(0x19f)+S(0x17f)](S(0x1e6)+S(0x129)+S(0x1d2)+S(0x174)+S(0x158))&&(error(S(0x1e2)+S(0xd9)+S(0x11b)+'['+f+S(0x1ab)+z[S(0x1e6)+'ge']),await a[S(0x1b8)](await applyFont(name,S(0x200)+S(0xbc)+S(0xe7)+S(0x16c))));}}function initializeRollover(){const T=a0B,a=DateTime[T(0x1fe)]()[T(0x111)+'ne'](TIME_ZONE),b=a[T(0x11c)](T(0x14e))[T(0x18a)]({'milliseconds':0x1}),c=b[T(0xf4)](a)['as'](T(0x19a)+T(0xc7)+'ds');setTimeout(()=>{const U=T,d=DateTime[U(0x1fe)]()[U(0x111)+'ne'](TIME_ZONE);for(const e of activity[U(0x17a)+'s']()){e[TIMEFRAMES[U(0x116)]][U(0x1c2)](),d[U(0x1a3)+'ay']===0x1&&(e[TIMEFRAMES[U(0x191)+U(0xfc)+'Y']]=new Map(e[TIMEFRAMES[U(0xfc)+'Y']]),e[TIMEFRAMES[U(0xfc)+'Y']][U(0x1c2)]()),d[U(0x14e)]===0x1&&e[TIMEFRAMES[U(0x128)+'LY']][U(0x1c2)](),d[U(0x14e)]===0x1&&d[U(0x1f9)]===0x1&&e[TIMEFRAMES[U(0x1e9)+'Y']][U(0x1c2)]();}markChanged(),initializeRollover();},c);}async function onShutdown(){const V=a0B;clearTimeout(saveTimer),await saveAllActivityToDB(),process[V(0x1d5)](0x0);}export async function initialize(a){const W=a0B;botApi=a[W(0xa0)],await initDatabase(),await loadActivityFromDB(),initializeRollover(),process['on'](W(0x1e0)+'T',onShutdown),process['on'](W(0x11d)+'RM',onShutdown),info(W(0x1ee)+W(0x173)+W(0x1b5)+W(0xd7)+W(0x1bf)+W(0x1fa)+W(0x149));}
