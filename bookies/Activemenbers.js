const a0B=a0b;function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0x6a;let f=c[d];if(a0b['tNHCTZ']===undefined){var g=function(l){const m='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let n='',o='';for(let p=0x0,q,r,s=0x0;r=l['charAt'](s++);~r&&(q=p%0x4?q*0x40+r:r,p++%0x4)?n+=String['fromCharCode'](0xff&q>>(-0x2*p&0x6)):0x0){r=m['indexOf'](r);}for(let t=0x0,u=n['length'];t<u;t++){o+='%'+('00'+n['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(o);};a0b['nHcryK']=g,a=arguments,a0b['tNHCTZ']=!![];}const h=c[0x0],i=d+h,j=a[i];return!j?(f=a0b['nHcryK'](f),a[i]=f):f=j,f;},a0b(a,b);}(function(a,b){const A=a0b,c=a();while(!![]){try{const d=-parseInt(A(0x119))/0x1*(parseInt(A(0x131))/0x2)+parseInt(A(0xa7))/0x3*(-parseInt(A(0xbc))/0x4)+-parseInt(A(0x13d))/0x5+-parseInt(A(0xf6))/0x6+-parseInt(A(0x7f))/0x7*(-parseInt(A(0x121))/0x8)+-parseInt(A(0x10f))/0x9*(parseInt(A(0x1af))/0xa)+parseInt(A(0x133))/0xb;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x4c824));import{InlineKeyboard}from'grammy';import{DateTime}from'luxon';import{db}from'../bookieutils/db.js';import{getDefault,getConnection}from'../bookieutils/connection.js';import{applyFont,registerModule}from'../bookieutils/helpeutils/fonthelp.js';import{info,error}from'../bookieutils/logger.js';import{getConfig}from'../bookieutils/config.js';export const name=a0B(0x1ae)+a0B(0x1be)+a0B(0x141);export const version=a0B(0x17f);registerModule(name);const CALLBACK_PREFIX=a0B(0xbd)+a0B(0xcf),TIME_ZONE=a0B(0xc5)+a0B(0xfd)+a0B(0x1a6),MAX_MESSAGES_TO_STORE=0x32,SAVE_DEBOUNCE_MS=0x3a98,USERS_PER_PAGE=0xa,TIMEFRAMES={'DAILY':a0B(0xc8),'WEEKLY':a0B(0xb3)+'y','MONTHLY':a0B(0x19a)+'ly','YEARLY':a0B(0x1d0)+'y','LAST_WEEKLY':a0B(0x19b)+a0B(0x185)};let activity=new Map(),botApi=null,saveTimer=null;const escapeHtml=a=>typeof a===a0B(0x1bd)+'g'?a[a0B(0x189)+'ce'](/&/g,a0B(0x1ca))[a0B(0x189)+'ce'](/</g,a0B(0xa8))[a0B(0x189)+'ce'](/>/g,a0B(0xb7))[a0B(0x189)+'ce'](/"/g,a0B(0xde)+';')[a0B(0x189)+'ce'](/'/g,a0B(0x71)+';'):a,isAdmin=a=>{const C=a0B;try{const {ADMINS:ADMINS=[]}=getConfig();return a[C(0x151)]?.['id']&&Array[C(0x1bc)+'ay'](ADMINS)&&ADMINS[C(0x16f)+C(0x134)](a[C(0x151)]['id']);}catch{return![];}};function getChatActivity(a){const D=a0B;return!activity[D(0x174)](a)&&activity[D(0xb0)](a,{[TIMEFRAMES[D(0x6c)]]:new Map(),[TIMEFRAMES[D(0x15f)+'Y']]:new Map(),[TIMEFRAMES[D(0x110)+'LY']]:new Map(),[TIMEFRAMES[D(0x176)+'Y']]:new Map(),[TIMEFRAMES[D(0xb8)+D(0x15f)+'Y']]:new Map()}),activity[D(0x17c)](a);}async function initDatabase(){const E=a0B;await db[E(0xb4)](E(0xee)+E(0x184)+E(0x106)+E(0x1c6)+E(0x1a5)+E(0xf9)+E(0x124)+E(0x171)+E(0x10e)+E(0x12d)+E(0x72)+E(0x16d)+E(0x1cf)+E(0x167)+E(0x82)+E(0xdd)+E(0x158)+E(0x72)+E(0x111)+E(0xaf)+E(0x109)+E(0x1c3)+E(0xf2)+E(0x125));}function rehydrateChatData(a){const F=a0B,b={};for(const c of Object[F(0xe6)+'s'](TIMEFRAMES)){const d=a[c]||[];b[c]=new Map(d[F(0x1a1)](([e,f])=>[Number(e),{...f,'m':new Set(f['m']||[])}]));}return b;}async function loadActivityFromDB(){const G=a0B,a=await db[G(0x17d)](G(0x163)+G(0x14a)+G(0x8f)+G(0xda)+G(0x1ad)+G(0xc0)+G(0x112)+G(0x1a2));activity[G(0x135)]();for(const {chat_id:b,data:c}of a){try{activity[G(0xb0)](b,rehydrateChatData(JSON[G(0xe4)](c)));}catch(d){await db[G(0x12e)](G(0x8c)+G(0xeb)+G(0x154)+G(0x171)+G(0x10e)+G(0x173)+G(0x160)+G(0x180)+G(0x8b),b),info(G(0x16e)+G(0x10c)+G(0x107)+G(0xa0)+G(0x98)+G(0x13c)+'t\x20'+b);}}}function dehydrate(a){const H=a0B,b={};for(const c of Object[H(0xe6)+'s'](TIMEFRAMES)){b[c]=Array[H(0x151)](a[c][H(0x114)+'es']())[H(0x1a1)](([d,e])=>[d,{...e,'m':Array[H(0x151)](e['m'])}]);}return b;}function a0a(){const X=['l3vZzxi','yxrHlG','Chq6oG','z2vZihi','zgf0zwq','iezst00','qwn0Axy','mte2ody5mej0y0zSvW','CYbJB24','zwqGzM8','xtOG','CMvMpsi','CMu/pc8','zgu+','zgf0yq','zgLMzG','igXHC3q','pc9IpIa','y2n1CNi','cGPqywC','AxnbCNi','C3rYAw4','zu1LBwi','DgL0Bgu','Aw4GDgG','zgvMyxu','AxmGCgu','vuXmcIa','vxnLCG','CMvZzxq','teuGsuy','B3uGC3u','D2vLAYC','4PYfierHDa','jMfTCdS','CMvWBhK','DxaGjW','z3vUisa','zNjHBwu','AwqGsu4','EwvHCMW','z3jVDxa','BMv3ihC','4P2mie5Via','BxnNCZO','zxnZywC','BwLSBgK','refjtfK','zxHPDa','8j+tIIbtzwW','8j+tHsbxzwu','Aw1LlIa','jImWmZK','icaGica','yMfJA1e','AxmGANu','idXHigG','zwvRj3m','4QYf77IpifbYzq','CMLVzc4','BgWGzgu','Dcbxzwu','vxnLCIa','y2HHDa','BgfZDge','ChjLDMK','ndq1ou5qrxnyvW','4P2mienHBG','CM93','ifbssu0','8j+tNcboBYa','pgi+','C2v0wM8','pgK+qsa','tMv4Dca','Bwf4','C2XPy2u','8j+tNcbnzxm','id0GpW','revmrvq','z2uG','BgvUz3q','Df9PzcW','ignOyxq','ChvZAa','8j+pHIbmyxm','DgC6lY8','DML0Esa','pgi+4PQG77Ipia','C29YDa','pc9JB2q','DgeGzM8','AxmGD2K','zwnVCMq','C2fNzxm','C2L6zq','4OcuidXIpG','BhrZlJW','AxPLzc4','zwqGzge','BMCUlI4','Ev9ZDge','lIa8y28','CgvYAw8','ywnRigu','icG/lca','nZHJBLfYAgO','jMX0oW','AhjLzJ0','vxnLic8','BhqGz3i','yxmGyMu','l2K+','C2vJB24','vevyvca','C2v0','BgLZDdO','8j+rPsbby3q','D2vLA2W','zxHLyW','B3jKzwq','iNrNoI8','jMD0oW','teftvf8','WQSGqMfJ','AxzLtwu','DwvYEq','mZu5odbwrhzbwwS','ywn0Bwu','zxqU','pgK+ka','igfJDgK','AxjT','8j+NUsbszxm','tgLZDa','zgf5','qwzYAwm','zxj5','4PYfiefJDa','zgfPBhK','BwvUDtO','igzVDw4','ipcFJ4pWN5kO','AYDZiem','igzVCIa','su5trvi','BtO6','A2X5','DgHPCYa','z2v0q2G','DxnLCM4','ihrPBwu','8j+AQYboB3q','quXvrvm','A2X5ieW','twvUDq','CM9Yig8','igrHDge','zgvSzxq','z2uGAxm','qvjzieS','jNf1B3q','vgHPCYa','AYb0BYa','4PYfifLLCW','zcWGzge','B3vZihC','CgfYC2u','igLUihi','DMfSDwu','qxjLihK','C3vWzxi','yw1L','y3rPDMu','rsbguK8','pgK+vxa','zM9Yrwe','cIaGica','DguGkgm','q0uGsu4','sfrnta','icaGktS','x25HBwu','ig5VDca','igf1DgG','mty5mZa2mMjjvLbztG','C2vYCYa','Awq9','rvHju1q','q2fSBgi','8j+uPsbmAxy','zxqGqwW','ys9oywK','B3jPEMu','Axb0Aw8','DgvZDca','8j+uMsbcywm','BgvHzgu','zc48l2K','zwvRigG','uKvqtee','rsbuqui','CNj1Chq','CIa8ysa','tK9uie4','Dgv4Da','B25ZipcFJ4y','zwqGy28','vgHLCMu','x3n0yxq','mtHtDNbnqvi','tu9oveG','zgf0ysa','DML0Ev8','x2nVBMy','zw50CMK','Bcbeyxq','vgLTzwy','Bgv0zsa','ihWGuge','oty1mxLlBM5YEa','C3qGyMu','p2LKpq','C3bSAxq','DgL2Axq','zsbMB3i','ihDLzwS','zsbxzwu','mtG0ofjhDMLTEG','Dg9vCha','l2XHC3q','uYbHy3q','cIaG','ve8Gywm','EsbYzwm','DxnLCJ8','C1DPDgG','ysbYzxm','CMfTzxm','D2vLA2q','zsaOcIa','CNvU','ihyZlJm','z2LUBMK','odjPDLLKwu4','y2fSBgi','mtq3ntG3nZDsq0j3Dg8','zgvZ','y2XLyxi','z2LMEq','lIa8ysa','C3rHCNq','BM93','u0Lhveu','ywn0Axy','CIbJAge','mtq5otKWzKnStKXf','DhjPBq','zMLYC3q','8j+oHIbzzwe','zxjZ','zvrLEhq','ywXSigq','cGO8At4','ihrOzsa','AxrPywW','x3bYB20','lJeGAw4','y2vS','vcbJAge','BgL2zsa','Agf0x2K','BwLU','lcbYzxm','CKnHBgW','pc9IpJO','zNjVBq','AxzLifu','BwjLCNm','tsbHy3q','yJ4kvgG','CgX1CW','ktWVAt4','rvKScIa','y2HHCKe','ChjPDMe','vcbpuIa','zM9Yia','zt4kcG','pc9HpIa','v0vfs0W','uKuGy2G','u2f2zwq','BxnNCW','u0vmrum','ywnRuxu','CNjVCIa','y2vPBa','vevhrvi','tM8Gywm','pc9HpGO','zxjdyxm','AwvK','CMjVyxi','y2HHDf8','rgvSzxq','Aw5JBhu','z2vZ','AxzPDhK','zwDLBMq','zsbxseu','AgfZ','l2fJDgK','wuvbuKW','AxnFyM8','CYdWN5sL','u0Lhsu4','DMLVDxm','zwrPDe0','z2v0','ywXS','B3vWihm','mY4ZlJe','yxrFAwq','AxjToJO','igzYB20','yw5ZD2u','q1jfqvq','zwvRBhK','4P2mieDYBW','zwn0ige','BgLZDa','CMvWBge','jYbUB3q','4PIa77IpierHAq','DgHSEq','DgePify','8j+xK++4JYbnB24','zxqH','j3mGBM8','AM9PBG','Dg9mB3C','CMX5','zgvZy3i','yxbP','BwvZC2e','ywrK','zwfSlxq','Bw9KAwy','Bw9UDgG','BgfZDfC','qw4Gzxi','DhLWzq','C2HPzNq','zw5Kt2y','AgfTCgK','BwfW','C3rHDgu','BwvUDq','ihjLC3u','ie5pvca','CM9IAq','zwqU'];a0a=function(){return X;};return a0a();}function markChanged(){clearTimeout(saveTimer),saveTimer=setTimeout(saveAllActivityToDB,SAVE_DEBOUNCE_MS);}async function saveAllActivityToDB(){const I=a0B;for(const [a,b]of activity[I(0x114)+'es']()){const c=JSON[I(0x1bd)+I(0x136)](dehydrate(b));await db[I(0x12e)](I(0xce)+I(0x15b)+I(0x105)+I(0xf0)+I(0x126)+I(0x11d)+I(0xa2)+I(0xef)+I(0x14c)+I(0xe2)+I(0x18d)+I(0xd6)+I(0xa6)+'?)',a,c);}info(I(0x161)+I(0xc0)+I(0x94)+I(0x15c)+activity[I(0x9c)]+(I(0x90)+'s'));}function trackMessage(a){const J=a0B,{from:b,chat:c,message:d}=a;if(!b||b[J(0x177)+'t']||isAdmin(a))return;const e=d?.[J(0x10a)];if(!e)return;const f=getChatActivity(c['id']);for(const g of[TIMEFRAMES[J(0x6c)],TIMEFRAMES[J(0x15f)+'Y'],TIMEFRAMES[J(0x110)+'LY'],TIMEFRAMES[J(0x176)+'Y']]){const h=f[g],i=h[J(0x17c)](b['id'])||{'c':0x0,'f':b[J(0x13f)+J(0xf3)],'u':b[J(0xd3)+J(0xe9)],'m':new Set()};i['c']++,i['f']=b[J(0x13f)+J(0xf3)],i['u']=b[J(0xd3)+J(0xe9)],i['m'][J(0x197)](e);if(i['m'][J(0x9c)]>MAX_MESSAGES_TO_STORE){const j=Array[J(0x151)](i['m']);j[J(0x19e)](),i['m']=new Set(j);}h[J(0xb0)](b['id'],i);}markChanged();}async function getPublicLeaderboard(a,b){const K=a0B,c=getChatActivity(a)[b],d=Array[K(0x151)](c[K(0x114)+'es']())[K(0x96)](([,k],[,l])=>l['c']-k['c'])[K(0x89)](0x0,0x19),e=b===TIMEFRAMES[K(0x15f)+'Y'],f=e?K(0xfb)+K(0x120)+K(0xd7)+K(0x172)+K(0x178):K(0x92)+K(0x7a)+K(0xcc)+K(0x1a0)+K(0x10b),g=await applyFont(name,f),h=e?K(0xec)+K(0x1ac)+K(0xe5)+K(0x198)+K(0x70)+K(0xaa)+K(0x7d)+K(0xea)+K(0xcd)+K(0x7e)+K(0xe3)+K(0x76)+K(0x1a4)+K(0x9e)+K(0xad):K(0x86)+K(0x1d2)+K(0x104)+K(0xac)+K(0x1cd)+K(0xaa)+K(0x13b)+K(0x11e)+K(0x145)+K(0x14b)+K(0x102)+K(0x16c)+K(0x103)+'>';if(!d[K(0x8e)+'h'])return g+'\x0a\x0a'+(e?K(0xdf)+K(0x1c8)+K(0x1b0)+K(0x100)+K(0x74)+K(0x11a)+K(0x130)+K(0xa1)+K(0xcb):K(0x10d)+K(0x190)+K(0xda)+K(0x182)+K(0x1b8)+K(0x11f)+'.')+'\x0a\x0a'+h;const i=e?['🏆','🥈','🥉']:['🥇','🥈','🥉'],j=d[K(0x1a1)](([k,l],m)=>{const L=K,n=l['u']?'@'+l['u']:escapeHtml(l['f']),o=m<0x3?'\x20'+i[m]:'';return m+0x1+(L(0x137)+L(0xa9)+L(0xb6)+L(0x1a8)+L(0x11b))+k+'\x22>'+n+(L(0x15e)+L(0x9d))+l['c']+(L(0x1b9)+L(0x196)+L(0x170))+o;});return g+'\x0a\x0a'+j[K(0x191)]('\x0a')+'\x0a\x0a'+h;}async function generateTimeframeMenu(a){const M=a0B,b=await botApi[M(0xd2)+'at'](a),c=await applyFont(name,M(0x6e)+M(0x187)+M(0xd4)+M(0x1ce)+M(0xcd)+M(0x84)+escapeHtml(b[M(0x1bf)])+M(0x150)),d=new InlineKeyboard()[M(0x10a)](M(0x18b)+'ly',CALLBACK_PREFIX+(M(0xb1)+':')+a+'::'+TIMEFRAMES[M(0x6c)])[M(0x10a)](M(0x6f)+M(0xd0),CALLBACK_PREFIX+(M(0xb1)+':')+a+'::'+TIMEFRAMES[M(0x15f)+'Y'])[M(0x81)]()[M(0x10a)](M(0x18e)+M(0x18c),CALLBACK_PREFIX+(M(0xb1)+':')+a+'::'+TIMEFRAMES[M(0x110)+'LY'])[M(0x10a)](M(0x140)+M(0x193),CALLBACK_PREFIX+(M(0xb1)+':')+a+'::'+TIMEFRAMES[M(0x176)+'Y'])[M(0x81)]()[M(0x10a)](M(0xc2)+M(0xfc)+M(0x115)+'a',CALLBACK_PREFIX+(M(0x1c5)+M(0x147)+M(0x1aa))+a);return{'text':c,'keyboard':d};}async function generateUserListMenu(a,b,c=0x1){const N=a0B,d=getChatActivity(a)[b];let e=await applyFont(name,N(0xb2)+N(0x152)+N(0xf7)+'('+(b[N(0x159)+'t'](0x0)[N(0x122)+N(0x16a)+'e']()+b[N(0x89)](0x1))+')');if(!d[N(0x9c)]){const k=new InlineKeyboard()[N(0x10a)](N(0x101)+'k',CALLBACK_PREFIX+(N(0xc9)+':')+a);return{'text':e+(N(0x144)+N(0x168)+N(0x11d)+N(0x127)+N(0xb5)+N(0xcd)+N(0xd1)+N(0xa4)+N(0x103)+'>'),'keyboard':k};}const f=Array[N(0x151)](d[N(0x114)+'es']())[N(0x96)](([,l],[,m])=>m['c']-l['c']),g=Math[N(0x166)](f[N(0x8e)+'h']/USERS_PER_PAGE);c=Math[N(0x88)](0x1,Math[N(0x14d)](c,g));const h=f[N(0x89)]((c-0x1)*USERS_PER_PAGE,c*USERS_PER_PAGE),i=new InlineKeyboard();h[N(0xed)+'ch'](([l,m])=>{const O=N,n=m['u']?'@'+m['u']:escapeHtml(m['f']);i[O(0x10a)](n+'\x20('+m['c']+')',CALLBACK_PREFIX+(O(0x1d4)+':')+a+'::'+b+'::'+l+'::'+c)[O(0x81)]();});const j=[];if(c>0x1)j[N(0x91)]({'text':N(0x77)+'v','callback_data':CALLBACK_PREFIX+(N(0xb1)+':')+a+'::'+b+'::'+(c-0x1)});if(c<g)j[N(0x91)]({'text':N(0x87)+'➡️','callback_data':CALLBACK_PREFIX+(N(0xb1)+':')+a+'::'+b+'::'+(c+0x1)});if(j[N(0x8e)+'h'])i[N(0x81)](...j);return i[N(0x10a)](N(0x101)+N(0xe0)+N(0x116)+N(0x12b),CALLBACK_PREFIX+(N(0xc9)+':')+a),e+=N(0x1bb)+'e\x20'+c+'/'+g,{'text':e,'keyboard':i};}async function generateUserMessagesView(a,b,c,d=0x1,e=0x1){const P=a0B,f=getChatActivity(a)[b][P(0x17c)](c),g=f?.['u']?'@'+f['u']:escapeHtml(f?.['f']||P(0x1c4));if(!f||!f['m'][P(0x9c)]){const q=await applyFont(name,P(0x83)+P(0x196)+P(0x1ab)+P(0x9a)+P(0x1b1)+P(0x108)+P(0xa9)+P(0xb6)+P(0x1a8)+P(0x11b)+c+'\x22>'+g+(P(0x15e)+P(0x1c0)+P(0x1c2)+P(0x78))),r=new InlineKeyboard()[P(0x10a)](P(0x101)+P(0xe0)+P(0x7b)+P(0xc3),CALLBACK_PREFIX+(P(0xb1)+':')+a+'::'+b+'::'+e);return{'text':q,'keyboard':r};}const h=Array[P(0x151)](f['m']),i=[];let j='';const k=P(0x8a)+P(0x9b)+P(0x182)+P(0x75)+P(0x1b3)+P(0x93)+P(0x128)+P(0xf8)+c+'\x22>'+g+P(0x169)+(P(0xbf)+(b[P(0x159)+'t'](0x0)[P(0x122)+P(0x16a)+'e']()+b[P(0x89)](0x1))+(P(0x157)+'\x0a\x0a'));h[P(0xed)+'ch']((s,t)=>{const Q=P,u=t+0x1+(Q(0xa3)+Q(0x1b5))+escapeHtml(s)+(Q(0x97)+Q(0x15d));j[Q(0x8e)+'h']+u[Q(0x8e)+'h']+k[Q(0x8e)+'h']>0xed8&&j&&(i[Q(0x91)](j),j=''),j+=u;});if(j)i[P(0x91)](j);const l=i[P(0x8e)+'h'];d=Math[P(0x88)](0x1,Math[P(0x14d)](d,l));const m=await applyFont(name,k[P(0x189)+'ce'](')',P(0x118)+P(0x8d)+d+'/'+l+')')),n=m+i[d-0x1],o=new InlineKeyboard(),p=[];if(d>0x1)p[P(0x91)]({'text':P(0x77)+P(0x17a),'callback_data':CALLBACK_PREFIX+(P(0x1d4)+':')+a+'::'+b+'::'+c+'::'+(d-0x1)+'::'+e});if(d<l)p[P(0x91)]({'text':P(0x87)+'➡️','callback_data':CALLBACK_PREFIX+(P(0x1d4)+':')+a+'::'+b+'::'+c+'::'+(d+0x1)+'::'+e});if(p[P(0x8e)+'h'])o[P(0x81)](...p);return o[P(0x10a)](P(0x101)+P(0xe0)+P(0x7b)+P(0xc3),CALLBACK_PREFIX+(P(0xb1)+':')+a+'::'+b+'::'+e),{'text':n,'keyboard':o};}export async function onMessage(a){const R=a0B;if(!botApi)botApi=a[R(0x195)];const b=[R(0x1d1),R(0xe8)+R(0x1d1)][R(0x16f)+R(0x134)](a[R(0x7c)][R(0x19d)]),c=a[R(0x196)+'ge']?.[R(0x10a)]?.[R(0x13e)]()?.[R(0x192)+R(0x16a)+'e']();if(b){trackMessage(a);if(c===R(0x175)+'ve'){const d=await getPublicLeaderboard(a[R(0x7c)]['id'],TIMEFRAMES[R(0x15f)+'Y']);return a[R(0x1cb)](d,{'parse_mode':R(0xf1),'disable_web_page_preview':!![]});}if(c===R(0x123)+R(0x13b)+'e'){const e=await getPublicLeaderboard(a[R(0x7c)]['id'],TIMEFRAMES[R(0xb8)+R(0x15f)+'Y']);return a[R(0x1cb)](e,{'parse_mode':R(0xf1),'disable_web_page_preview':!![]});}}if(a[R(0x7c)][R(0x19d)]===R(0x15a)+'te'&&isAdmin(a)&&c===R(0x175)+'ve'){const f=await getDefault();if(!f)return a[R(0x1cb)](await applyFont(name,R(0x1d3)+R(0x1c1)+R(0xab)+R(0x17e)+R(0xbe)));const g=await getConnection(f);if(!g)return a[R(0x1cb)](await applyFont(name,R(0x186)+R(0x1cc)+f+(R(0x18a)+R(0xca)+'d.')));const {text:h,keyboard:i}=await generateTimeframeMenu(g);await a[R(0x1cb)](h,{'parse_mode':R(0xf1),'reply_markup':i});}}export async function onCallbackQuery(a){const S=a0B,b=a[S(0x132)+S(0x164)+S(0xc6)]?.[S(0x1b6)];if(!b?.[S(0x138)+S(0x129)](CALLBACK_PREFIX)||!isAdmin(a))return a[S(0x183)+S(0x14f)+S(0x73)+S(0xbb)]({'text':S(0xd5)+S(0xf5)+S(0xfe)+'d','show_alert':!![]});await a[S(0x183)+S(0x14f)+S(0x73)+S(0xbb)]();if(!botApi)botApi=a[S(0x195)];const c=b[S(0x11c)]('::'),f=c[0x1];try{switch(f){case S(0x1a3):{const g=Number(c[0x2]),{text:h,keyboard:i}=await generateTimeframeMenu(g);await a[S(0x17b)+S(0x6a)+S(0x142)](h,{'parse_mode':S(0xf1),'reply_markup':i});break;}case S(0x188):{const j=Number(c[0x2]),k=c[0x3],l=Number(c[0x4])||0x1,{text:m,keyboard:n}=await generateUserListMenu(j,k,l);await a[S(0x17b)+S(0x6a)+S(0x142)](m,{'parse_mode':S(0xf1),'reply_markup':n});break;}case S(0x162):{const o=Number(c[0x2]),p=c[0x3],q=Number(c[0x4]);let r=0x1,s=0x1;if(c[S(0x8e)+'h']===0x6)s=Number(c[0x5]);else c[S(0x8e)+'h']>=0x7&&(r=Number(c[0x5]),s=Number(c[0x6]));const {text:t,keyboard:u}=await generateUserMessagesView(o,p,q,r,s);await a[S(0x17b)+S(0x6a)+S(0x142)](t,{'parse_mode':S(0xf1),'reply_markup':u,'disable_web_page_preview':!![]});break;}case S(0x1c5)+S(0x147)+'pt':{const v=Number(c[0x2]),w=new InlineKeyboard()[S(0x10a)](S(0xe1)+S(0x14e)+S(0x18f),CALLBACK_PREFIX+(S(0x1c5)+S(0x113)+S(0x181))+v)[S(0x10a)](S(0x80)+S(0x149),CALLBACK_PREFIX+(S(0xc9)+':')+v);await a[S(0x17b)+S(0x6a)+S(0x142)](await applyFont(name,S(0x95)+S(0xe7)+S(0x1c7)+S(0x1b4)+S(0x155)+S(0x99)+S(0x79)+S(0x117)+S(0x143)+S(0x1a9)),{'parse_mode':S(0xf1),'reply_markup':w});break;}case S(0x1c5)+S(0x113)+S(0xc1):{const x=Number(c[0x2]);activity[S(0xdb)+'e'](x),await db[S(0x12e)](S(0x8c)+S(0xeb)+S(0x154)+S(0x171)+S(0x10e)+S(0x173)+S(0x160)+S(0x180)+S(0x8b),x),markChanged();const y=new InlineKeyboard()[S(0x10a)](S(0xb9)+S(0xe0)+S(0xd8),CALLBACK_PREFIX+(S(0xc9)+':')+x);await a[S(0x17b)+S(0x6a)+S(0x142)](await applyFont(name,S(0x1c9)+S(0x12a)+S(0xbe)),{'reply_markup':y});break;}}}catch(z){!z[S(0x194)+S(0xff)+'n']?.[S(0x16f)+S(0x134)](S(0x196)+S(0xdc)+S(0xf4)+S(0x199)+S(0x16b))&&(error(S(0xfa)+S(0xa5)+S(0x165)+'['+f+S(0x1b2)+z[S(0x196)+'ge']),await a[S(0x1cb)](await applyFont(name,S(0x19c)+S(0xd9)+S(0x1ba)+S(0x1a7))));}}function initializeRollover(){const T=a0B,a=DateTime[T(0x139)]()[T(0x85)+'ne'](TIME_ZONE),b=a[T(0x19f)](T(0xc4))[T(0x156)]({'milliseconds':0x1}),c=b[T(0x1b7)](a)['as'](T(0x6b)+T(0xae)+'ds');setTimeout(()=>{const U=T,d=DateTime[U(0x139)]()[U(0x85)+'ne'](TIME_ZONE);for(const e of activity[U(0xe6)+'s']()){e[TIMEFRAMES[U(0x6c)]][U(0x135)](),d[U(0x12c)+'ay']===0x1&&(e[TIMEFRAMES[U(0xb8)+U(0x15f)+'Y']]=new Map(e[TIMEFRAMES[U(0x15f)+'Y']]),e[TIMEFRAMES[U(0x15f)+'Y']][U(0x135)]()),d[U(0xc4)]===0x1&&e[TIMEFRAMES[U(0x110)+'LY']][U(0x135)](),d[U(0xc4)]===0x1&&d[U(0x19a)]===0x1&&e[TIMEFRAMES[U(0x176)+'Y']][U(0x135)]();}markChanged(),initializeRollover();},c);}async function onShutdown(){const V=a0B;clearTimeout(saveTimer),await saveAllActivityToDB(),process[V(0x6d)](0x0);}export async function initialize(a){const W=a0B;botApi=a[W(0x195)],await initDatabase(),await loadActivityFromDB(),initializeRollover(),process['on'](W(0x179)+'T',onShutdown),process['on'](W(0x13a)+'RM',onShutdown),info(W(0xc7)+W(0xba)+W(0x153)+W(0x12f)+W(0x148)+W(0x146)+W(0x9f));}